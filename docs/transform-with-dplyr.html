<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Data Science for Transportation Researchers, Planners, and Engineers</title>
  <meta name="description" content="Introduction to Data Science for Transportation Researchers, Planners, and Engineers">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Data Science for Transportation Researchers, Planners, and Engineers" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="cities/datascience" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Data Science for Transportation Researchers, Planners, and Engineers" />
  
  
  

<meta name="author" content="Liming Wang">


<meta name="date" content="2017-08-28">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="tidy.html">
<link rel="next" href="visualize.html">
<script src="book_assets/jquery-2.2.3/jquery.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Syllabus</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#prerequisite"><i class="fa fa-check"></i><b>1.1</b> Prerequisite</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#format"><i class="fa fa-check"></i><b>1.2</b> Format</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#software-and-hardware"><i class="fa fa-check"></i><b>1.3</b> Software and Hardware</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#textbook-and-readings"><i class="fa fa-check"></i><b>1.4</b> Textbook and Readings</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#topics"><i class="fa fa-check"></i><b>1.5</b> Topics</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.6</b> License</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#readings"><i class="fa fa-check"></i><b>2.1</b> Readings</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#introduction-1"><i class="fa fa-check"></i><b>2.2</b> Introduction</a><ul>
<li class="chapter" data-level="2.2.1" data-path="introduction.html"><a href="introduction.html#best-practices-for-data-science-wilson-et-al-2012"><i class="fa fa-check"></i><b>2.2.1</b> Best practices for data science (Wilson et al, 2012)</a></li>
<li class="chapter" data-level="2.2.2" data-path="introduction.html"><a href="introduction.html#the-tidyverse-work-flow"><i class="fa fa-check"></i><b>2.2.2</b> The tidyverse work flow</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#r-and-rstudio"><i class="fa fa-check"></i><b>2.3</b> R and RStudio</a><ul>
<li class="chapter" data-level="2.3.1" data-path="introduction.html"><a href="introduction.html#installation"><i class="fa fa-check"></i><b>2.3.1</b> Installation</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction.html"><a href="introduction.html#testing-testing"><i class="fa fa-check"></i><b>2.3.2</b> Testing testing</a></li>
<li class="chapter" data-level="2.3.3" data-path="introduction.html"><a href="introduction.html#add-on-packages"><i class="fa fa-check"></i><b>2.3.3</b> Add-on packages</a></li>
<li class="chapter" data-level="2.3.4" data-path="introduction.html"><a href="introduction.html#r-and-rstudio-tutorial"><i class="fa fa-check"></i><b>2.3.4</b> R and RStudio tutorial</a></li>
<li class="chapter" data-level="2.3.5" data-path="introduction.html"><a href="introduction.html#project-orgnization-in-rstudio"><i class="fa fa-check"></i><b>2.3.5</b> Project orgnization in RStudio</a></li>
<li class="chapter" data-level="2.3.6" data-path="introduction.html"><a href="introduction.html#set-up-github-and-clone-datascience-course-repository"><i class="fa fa-check"></i><b>2.3.6</b> Set up github and clone datascience course repository</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#learning-more"><i class="fa fa-check"></i><b>2.4</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming-with-r.html"><a href="programming-with-r.html"><i class="fa fa-check"></i><b>3</b> Programming with R</a><ul>
<li class="chapter" data-level="3.1" data-path="programming-with-r.html"><a href="programming-with-r.html#readings-1"><i class="fa fa-check"></i><b>3.1</b> Readings</a></li>
<li class="chapter" data-level="3.2" data-path="programming-with-r.html"><a href="programming-with-r.html#starting-with-data"><i class="fa fa-check"></i><b>3.2</b> Starting with Data</a><ul>
<li class="chapter" data-level="3.2.1" data-path="programming-with-r.html"><a href="programming-with-r.html#loading-data"><i class="fa fa-check"></i><b>3.2.1</b> Loading Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="programming-with-r.html"><a href="programming-with-r.html#manipulating-data"><i class="fa fa-check"></i><b>3.2.2</b> Manipulating Data</a></li>
<li class="chapter" data-level="3.2.3" data-path="programming-with-r.html"><a href="programming-with-r.html#plotting"><i class="fa fa-check"></i><b>3.2.3</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="programming-with-r.html"><a href="programming-with-r.html#creating-functions"><i class="fa fa-check"></i><b>3.3</b> Creating Functions</a><ul>
<li class="chapter" data-level="3.3.1" data-path="programming-with-r.html"><a href="programming-with-r.html#defining-a-function"><i class="fa fa-check"></i><b>3.3.1</b> Defining a Function</a></li>
<li class="chapter" data-level="3.3.2" data-path="programming-with-r.html"><a href="programming-with-r.html#composing-functions"><i class="fa fa-check"></i><b>3.3.2</b> Composing Functions</a></li>
<li class="chapter" data-level="3.3.3" data-path="programming-with-r.html"><a href="programming-with-r.html#testing-and-documenting"><i class="fa fa-check"></i><b>3.3.3</b> Testing and Documenting</a></li>
<li class="chapter" data-level="3.3.4" data-path="programming-with-r.html"><a href="programming-with-r.html#defining-defaults"><i class="fa fa-check"></i><b>3.3.4</b> Defining Defaults</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="programming-with-r.html"><a href="programming-with-r.html#loops-in-r"><i class="fa fa-check"></i><b>3.4</b> Loops in R</a><ul>
<li class="chapter" data-level="3.4.1" data-path="programming-with-r.html"><a href="programming-with-r.html#for-loops"><i class="fa fa-check"></i><b>3.4.1</b> For Loops</a></li>
<li class="chapter" data-level="3.4.2" data-path="programming-with-r.html"><a href="programming-with-r.html#processing-multiple-files"><i class="fa fa-check"></i><b>3.4.2</b> Processing Multiple Files</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="programming-with-r.html"><a href="programming-with-r.html#best-practice-for-repetition"><i class="fa fa-check"></i><b>3.5</b> Best Practice for Repetition</a><ul>
<li class="chapter" data-level="3.5.1" data-path="programming-with-r.html"><a href="programming-with-r.html#vectorized-operations"><i class="fa fa-check"></i><b>3.5.1</b> Vectorized Operations</a></li>
<li class="chapter" data-level="3.5.2" data-path="programming-with-r.html"><a href="programming-with-r.html#vector-recycling"><i class="fa fa-check"></i><b>3.5.2</b> Vector Recycling</a></li>
<li class="chapter" data-level="3.5.3" data-path="programming-with-r.html"><a href="programming-with-r.html#for-or-apply"><i class="fa fa-check"></i><b>3.5.3</b> <code>for</code> or <code>apply</code>?</a></li>
<li class="chapter" data-level="3.5.4" data-path="programming-with-r.html"><a href="programming-with-r.html#loops-in-r-are-slow"><i class="fa fa-check"></i><b>3.5.4</b> Loops in R Are Slow</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="programming-with-r.html"><a href="programming-with-r.html#make-choices"><i class="fa fa-check"></i><b>3.6</b> Make Choices</a><ul>
<li class="chapter" data-level="3.6.1" data-path="programming-with-r.html"><a href="programming-with-r.html#saving-plots-to-a-file"><i class="fa fa-check"></i><b>3.6.1</b> Saving Plots to a File</a></li>
<li class="chapter" data-level="3.6.2" data-path="programming-with-r.html"><a href="programming-with-r.html#conditionals"><i class="fa fa-check"></i><b>3.6.2</b> Conditionals</a></li>
<li class="chapter" data-level="3.6.3" data-path="programming-with-r.html"><a href="programming-with-r.html#saving-automatically-generated-figures"><i class="fa fa-check"></i><b>3.6.3</b> Saving Automatically Generated Figures</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="programming-with-r.html"><a href="programming-with-r.html#command-line-programs"><i class="fa fa-check"></i><b>3.7</b> Command-Line Programs</a><ul>
<li class="chapter" data-level="3.7.1" data-path="programming-with-r.html"><a href="programming-with-r.html#command-line-arguments"><i class="fa fa-check"></i><b>3.7.1</b> Command-Line Arguments</a></li>
<li class="chapter" data-level="3.7.2" data-path="programming-with-r.html"><a href="programming-with-r.html#handling-multiple-files"><i class="fa fa-check"></i><b>3.7.2</b> Handling Multiple Files</a></li>
<li class="chapter" data-level="3.7.3" data-path="programming-with-r.html"><a href="programming-with-r.html#handling-command-line-flags"><i class="fa fa-check"></i><b>3.7.3</b> Handling Command-Line Flags</a></li>
<li class="chapter" data-level="3.7.4" data-path="programming-with-r.html"><a href="programming-with-r.html#handling-standard-input"><i class="fa fa-check"></i><b>3.7.4</b> Handling Standard Input</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="programming-with-r.html"><a href="programming-with-r.html#addressing-data"><i class="fa fa-check"></i><b>3.8</b> Addressing Data</a><ul>
<li class="chapter" data-level="3.8.1" data-path="programming-with-r.html"><a href="programming-with-r.html#addressing-by-index"><i class="fa fa-check"></i><b>3.8.1</b> Addressing by Index</a></li>
<li class="chapter" data-level="3.8.2" data-path="programming-with-r.html"><a href="programming-with-r.html#addressing-by-name"><i class="fa fa-check"></i><b>3.8.2</b> Addressing by Name</a></li>
<li class="chapter" data-level="3.8.3" data-path="programming-with-r.html"><a href="programming-with-r.html#logical-indexing"><i class="fa fa-check"></i><b>3.8.3</b> Logical Indexing</a></li>
<li class="chapter" data-level="3.8.4" data-path="programming-with-r.html"><a href="programming-with-r.html#combining-indexing-and-assignment"><i class="fa fa-check"></i><b>3.8.4</b> Combining Indexing and Assignment</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="programming-with-r.html"><a href="programming-with-r.html#r-data-structures"><i class="fa fa-check"></i><b>3.9</b> R Data Structures</a><ul>
<li class="chapter" data-level="3.9.1" data-path="programming-with-r.html"><a href="programming-with-r.html#understanding-basic-data-types-in-r"><i class="fa fa-check"></i><b>3.9.1</b> Understanding Basic Data Types in R</a></li>
<li class="chapter" data-level="3.9.2" data-path="programming-with-r.html"><a href="programming-with-r.html#atomic-vectors"><i class="fa fa-check"></i><b>3.9.2</b> Atomic Vectors</a></li>
<li class="chapter" data-level="3.9.3" data-path="programming-with-r.html"><a href="programming-with-r.html#the-different-vector-modes"><i class="fa fa-check"></i><b>3.9.3</b> The Different Vector Modes</a></li>
<li class="chapter" data-level="3.9.4" data-path="programming-with-r.html"><a href="programming-with-r.html#examining-vectors"><i class="fa fa-check"></i><b>3.9.4</b> Examining Vectors</a></li>
<li class="chapter" data-level="3.9.5" data-path="programming-with-r.html"><a href="programming-with-r.html#adding-elements"><i class="fa fa-check"></i><b>3.9.5</b> Adding Elements</a></li>
<li class="chapter" data-level="3.9.6" data-path="programming-with-r.html"><a href="programming-with-r.html#vectors-from-a-sequence-of-numbers"><i class="fa fa-check"></i><b>3.9.6</b> Vectors from a Sequence of Numbers</a></li>
<li class="chapter" data-level="3.9.7" data-path="programming-with-r.html"><a href="programming-with-r.html#missing-data"><i class="fa fa-check"></i><b>3.9.7</b> Missing Data</a></li>
<li class="chapter" data-level="3.9.8" data-path="programming-with-r.html"><a href="programming-with-r.html#other-special-values"><i class="fa fa-check"></i><b>3.9.8</b> Other Special Values</a></li>
<li class="chapter" data-level="3.9.9" data-path="programming-with-r.html"><a href="programming-with-r.html#what-happens-when-you-mix-types-inside-a-vector"><i class="fa fa-check"></i><b>3.9.9</b> What Happens When You Mix Types Inside a Vector?</a></li>
<li class="chapter" data-level="3.9.10" data-path="programming-with-r.html"><a href="programming-with-r.html#objects-attributes"><i class="fa fa-check"></i><b>3.9.10</b> Objects Attributes</a></li>
<li class="chapter" data-level="3.9.11" data-path="programming-with-r.html"><a href="programming-with-r.html#matrix"><i class="fa fa-check"></i><b>3.9.11</b> Matrix</a></li>
<li class="chapter" data-level="3.9.12" data-path="programming-with-r.html"><a href="programming-with-r.html#list"><i class="fa fa-check"></i><b>3.9.12</b> List</a></li>
<li class="chapter" data-level="3.9.13" data-path="programming-with-r.html"><a href="programming-with-r.html#data-frame"><i class="fa fa-check"></i><b>3.9.13</b> Data Frame</a></li>
<li class="chapter" data-level="3.9.14" data-path="programming-with-r.html"><a href="programming-with-r.html#creating-data-frames-by-hand"><i class="fa fa-check"></i><b>3.9.14</b> Creating Data Frames by Hand</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="programming-with-r.html"><a href="programming-with-r.html#understanding-factors"><i class="fa fa-check"></i><b>3.10</b> Understanding Factors</a><ul>
<li class="chapter" data-level="3.10.1" data-path="programming-with-r.html"><a href="programming-with-r.html#converting-factors"><i class="fa fa-check"></i><b>3.10.1</b> Converting Factors</a></li>
<li class="chapter" data-level="3.10.2" data-path="programming-with-r.html"><a href="programming-with-r.html#using-factors"><i class="fa fa-check"></i><b>3.10.2</b> Using Factors</a></li>
<li class="chapter" data-level="3.10.3" data-path="programming-with-r.html"><a href="programming-with-r.html#removing-levels-from-a-factor"><i class="fa fa-check"></i><b>3.10.3</b> Removing Levels from a Factor</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="programming-with-r.html"><a href="programming-with-r.html#learning-more-1"><i class="fa fa-check"></i><b>3.11</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="version-control-with-git.html"><a href="version-control-with-git.html"><i class="fa fa-check"></i><b>4</b> Version Control with Git</a><ul>
<li class="chapter" data-level="4.1" data-path="version-control-with-git.html"><a href="version-control-with-git.html#readings-2"><i class="fa fa-check"></i><b>4.1</b> Readings</a></li>
<li class="chapter" data-level="4.2" data-path="version-control-with-git.html"><a href="version-control-with-git.html#introduction-2"><i class="fa fa-check"></i><b>4.2</b> Introduction</a></li>
<li class="chapter" data-level="4.3" data-path="version-control-with-git.html"><a href="version-control-with-git.html#setting-up-git"><i class="fa fa-check"></i><b>4.3</b> Setting up Git</a></li>
<li class="chapter" data-level="4.4" data-path="version-control-with-git.html"><a href="version-control-with-git.html#creating-a-repository"><i class="fa fa-check"></i><b>4.4</b> Creating a Repository</a></li>
<li class="chapter" data-level="4.5" data-path="version-control-with-git.html"><a href="version-control-with-git.html#tracking-changes"><i class="fa fa-check"></i><b>4.5</b> Tracking Changes</a></li>
<li class="chapter" data-level="4.6" data-path="version-control-with-git.html"><a href="version-control-with-git.html#exploring-history"><i class="fa fa-check"></i><b>4.6</b> Exploring History</a></li>
<li class="chapter" data-level="4.7" data-path="version-control-with-git.html"><a href="version-control-with-git.html#ignoring-things"><i class="fa fa-check"></i><b>4.7</b> Ignoring Things</a></li>
<li class="chapter" data-level="4.8" data-path="version-control-with-git.html"><a href="version-control-with-git.html#remotes-in-github"><i class="fa fa-check"></i><b>4.8</b> Remotes in GitHub</a></li>
<li class="chapter" data-level="4.9" data-path="version-control-with-git.html"><a href="version-control-with-git.html#collaborating"><i class="fa fa-check"></i><b>4.9</b> Collaborating</a></li>
<li class="chapter" data-level="4.10" data-path="version-control-with-git.html"><a href="version-control-with-git.html#conflicts"><i class="fa fa-check"></i><b>4.10</b> Conflicts</a></li>
<li class="chapter" data-level="4.11" data-path="version-control-with-git.html"><a href="version-control-with-git.html#open-science"><i class="fa fa-check"></i><b>4.11</b> Open Science</a></li>
<li class="chapter" data-level="4.12" data-path="version-control-with-git.html"><a href="version-control-with-git.html#licensing"><i class="fa fa-check"></i><b>4.12</b> Licensing</a></li>
<li class="chapter" data-level="4.13" data-path="version-control-with-git.html"><a href="version-control-with-git.html#citation"><i class="fa fa-check"></i><b>4.13</b> Citation</a></li>
<li class="chapter" data-level="4.14" data-path="version-control-with-git.html"><a href="version-control-with-git.html#hosting"><i class="fa fa-check"></i><b>4.14</b> Hosting</a></li>
<li class="chapter" data-level="4.15" data-path="version-control-with-git.html"><a href="version-control-with-git.html#using-git-from-rstudio"><i class="fa fa-check"></i><b>4.15</b> Using Git from RStudio</a></li>
<li class="chapter" data-level="4.16" data-path="version-control-with-git.html"><a href="version-control-with-git.html#learn-more"><i class="fa fa-check"></i><b>4.16</b> Learn more</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>5</b> Import</a><ul>
<li class="chapter" data-level="5.1" data-path="import.html"><a href="import.html#readings-3"><i class="fa fa-check"></i><b>5.1</b> Readings</a></li>
<li class="chapter" data-level="5.2" data-path="import.html"><a href="import.html#tibbles-vs.data.frame"><i class="fa fa-check"></i><b>5.2</b> Tibbles vs. data.frame</a><ul>
<li class="chapter" data-level="5.2.1" data-path="import.html"><a href="import.html#data-frames-are-awesome"><i class="fa fa-check"></i><b>5.2.1</b> Data frames are awesome</a></li>
<li class="chapter" data-level="5.2.2" data-path="import.html"><a href="import.html#printing"><i class="fa fa-check"></i><b>5.2.2</b> Printing</a></li>
<li class="chapter" data-level="5.2.3" data-path="import.html"><a href="import.html#subsetting"><i class="fa fa-check"></i><b>5.2.3</b> Subsetting</a></li>
<li class="chapter" data-level="5.2.4" data-path="import.html"><a href="import.html#converting"><i class="fa fa-check"></i><b>5.2.4</b> Converting</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="import.html"><a href="import.html#data-import"><i class="fa fa-check"></i><b>5.3</b> Data Import</a><ul>
<li class="chapter" data-level="5.3.1" data-path="import.html"><a href="import.html#compared-to-base-r"><i class="fa fa-check"></i><b>5.3.1</b> Compared to base R</a></li>
<li class="chapter" data-level="5.3.2" data-path="import.html"><a href="import.html#exercises"><i class="fa fa-check"></i><b>5.3.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="import.html"><a href="import.html#writing-to-a-file"><i class="fa fa-check"></i><b>5.4</b> Writing to a file</a></li>
<li class="chapter" data-level="5.5" data-path="import.html"><a href="import.html#learn-more-1"><i class="fa fa-check"></i><b>5.5</b> Learn More</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tidy.html"><a href="tidy.html"><i class="fa fa-check"></i><b>6</b> Tidy</a><ul>
<li class="chapter" data-level="6.1" data-path="tidy.html"><a href="tidy.html#readings-4"><i class="fa fa-check"></i><b>6.1</b> Readings</a></li>
<li class="chapter" data-level="6.2" data-path="tidy.html"><a href="tidy.html#introduction-3"><i class="fa fa-check"></i><b>6.2</b> Introduction</a><ul>
<li class="chapter" data-level="6.2.1" data-path="tidy.html"><a href="tidy.html#prerequisites"><i class="fa fa-check"></i><b>6.2.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="tidy.html"><a href="tidy.html#tidy-data"><i class="fa fa-check"></i><b>6.3</b> Tidy data</a></li>
<li class="chapter" data-level="6.4" data-path="tidy.html"><a href="tidy.html#spreading-and-gathering"><i class="fa fa-check"></i><b>6.4</b> Spreading and gathering</a><ul>
<li class="chapter" data-level="6.4.1" data-path="tidy.html"><a href="tidy.html#gathering"><i class="fa fa-check"></i><b>6.4.1</b> Gathering</a></li>
<li class="chapter" data-level="6.4.2" data-path="tidy.html"><a href="tidy.html#spreading"><i class="fa fa-check"></i><b>6.4.2</b> Spreading</a></li>
<li class="chapter" data-level="6.4.3" data-path="tidy.html"><a href="tidy.html#exercises-1"><i class="fa fa-check"></i><b>6.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="tidy.html"><a href="tidy.html#separating-and-uniting"><i class="fa fa-check"></i><b>6.5</b> Separating and uniting</a><ul>
<li class="chapter" data-level="6.5.1" data-path="tidy.html"><a href="tidy.html#separate"><i class="fa fa-check"></i><b>6.5.1</b> Separate</a></li>
<li class="chapter" data-level="6.5.2" data-path="tidy.html"><a href="tidy.html#unite"><i class="fa fa-check"></i><b>6.5.2</b> Unite</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="tidy.html"><a href="tidy.html#case-study"><i class="fa fa-check"></i><b>6.6</b> Case Study</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html"><i class="fa fa-check"></i><b>7</b> Transform with dplyr</a><ul>
<li class="chapter" data-level="7.1" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#readings-5"><i class="fa fa-check"></i><b>7.1</b> Readings</a></li>
<li class="chapter" data-level="7.2" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#prerequisites-1"><i class="fa fa-check"></i><b>7.2</b> Prerequisites</a></li>
<li class="chapter" data-level="7.3" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#dplyr-introduction"><i class="fa fa-check"></i><b>7.3</b> dplyr introduction</a><ul>
<li class="chapter" data-level="7.3.1" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#say-hello-to-the-gapminder-tibble"><i class="fa fa-check"></i><b>7.3.1</b> Say hello to the Gapminder tibble</a></li>
<li class="chapter" data-level="7.3.2" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#think-before-you-create-excerpts-of-your-data"><i class="fa fa-check"></i><b>7.3.2</b> Think before you create excerpts of your data …</a></li>
<li class="chapter" data-level="7.3.3" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#use-filter-to-subset-data-row-wise."><i class="fa fa-check"></i><b>7.3.3</b> Use <code>filter()</code> to subset data row-wise.</a></li>
<li class="chapter" data-level="7.3.4" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#meet-the-new-pipe-operator"><i class="fa fa-check"></i><b>7.3.4</b> Meet the new pipe operator</a></li>
<li class="chapter" data-level="7.3.5" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#use-select-to-subset-the-data-on-variables-or-columns."><i class="fa fa-check"></i><b>7.3.5</b> Use <code>select()</code> to subset the data on variables or columns.</a></li>
<li class="chapter" data-level="7.3.6" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#revel-in-the-convenience"><i class="fa fa-check"></i><b>7.3.6</b> Revel in the convenience</a></li>
<li class="chapter" data-level="7.3.7" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#pure-predictable-pipeable"><i class="fa fa-check"></i><b>7.3.7</b> Pure, predictable, pipeable</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#dplyr-grammar"><i class="fa fa-check"></i><b>7.4</b> dplyr grammar</a><ul>
<li class="chapter" data-level="7.4.1" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#create-a-copy-of-gapminder"><i class="fa fa-check"></i><b>7.4.1</b> Create a copy of gapminder</a></li>
<li class="chapter" data-level="7.4.2" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#use-mutate-to-add-new-variables"><i class="fa fa-check"></i><b>7.4.2</b> Use <code>mutate()</code> to add new variables</a></li>
<li class="chapter" data-level="7.4.3" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#use-arrange-to-row-order-data-in-a-principled-way"><i class="fa fa-check"></i><b>7.4.3</b> Use <code>arrange()</code> to row-order data in a principled way</a></li>
<li class="chapter" data-level="7.4.4" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#use-rename-to-rename-variables"><i class="fa fa-check"></i><b>7.4.4</b> Use <code>rename()</code> to rename variables</a></li>
<li class="chapter" data-level="7.4.5" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#select-can-rename-and-reposition-variables"><i class="fa fa-check"></i><b>7.4.5</b> <code>select()</code> can rename and reposition variables</a></li>
<li class="chapter" data-level="7.4.6" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#group_by-is-a-mighty-weapon"><i class="fa fa-check"></i><b>7.4.6</b> <code>group_by()</code> is a mighty weapon</a></li>
<li class="chapter" data-level="7.4.7" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#grouped-mutate"><i class="fa fa-check"></i><b>7.4.7</b> Grouped mutate</a></li>
<li class="chapter" data-level="7.4.8" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#grand-finale"><i class="fa fa-check"></i><b>7.4.8</b> Grand Finale</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#working-with-two-datasets"><i class="fa fa-check"></i><b>7.5</b> Working with two datasets</a><ul>
<li class="chapter" data-level="7.5.1" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#inner_joinsuperheroes-publishers"><i class="fa fa-check"></i><b>7.5.1</b> inner_join(superheroes, publishers)</a></li>
<li class="chapter" data-level="7.5.2" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#semi_joinsuperheroes-publishers"><i class="fa fa-check"></i><b>7.5.2</b> semi_join(superheroes, publishers)</a></li>
<li class="chapter" data-level="7.5.3" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#left_joinsuperheroes-publishers"><i class="fa fa-check"></i><b>7.5.3</b> left_join(superheroes, publishers)</a></li>
<li class="chapter" data-level="7.5.4" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#anti_joinsuperheroes-publishers"><i class="fa fa-check"></i><b>7.5.4</b> anti_join(superheroes, publishers)</a></li>
<li class="chapter" data-level="7.5.5" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#inner_joinpublishers-superheroes"><i class="fa fa-check"></i><b>7.5.5</b> inner_join(publishers, superheroes)</a></li>
<li class="chapter" data-level="7.5.6" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#semi_joinpublishers-superheroes"><i class="fa fa-check"></i><b>7.5.6</b> semi_join(publishers, superheroes)</a></li>
<li class="chapter" data-level="7.5.7" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#left_joinpublishers-superheroes"><i class="fa fa-check"></i><b>7.5.7</b> left_join(publishers, superheroes)</a></li>
<li class="chapter" data-level="7.5.8" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#anti_joinpublishers-superheroes"><i class="fa fa-check"></i><b>7.5.8</b> anti_join(publishers, superheroes)</a></li>
<li class="chapter" data-level="7.5.9" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#full_joinsuperheroes-publishers"><i class="fa fa-check"></i><b>7.5.9</b> full_join(superheroes, publishers)</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="transform-with-dplyr.html"><a href="transform-with-dplyr.html#learn-more-2"><i class="fa fa-check"></i><b>7.6</b> Learn more</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="visualize.html"><a href="visualize.html"><i class="fa fa-check"></i><b>8</b> Visualize</a><ul>
<li class="chapter" data-level="8.1" data-path="visualize.html"><a href="visualize.html#readings-6"><i class="fa fa-check"></i><b>8.1</b> Readings</a></li>
<li class="chapter" data-level="8.2" data-path="visualize.html"><a href="visualize.html#introduction-4"><i class="fa fa-check"></i><b>8.2</b> Introduction</a><ul>
<li class="chapter" data-level="8.2.1" data-path="visualize.html"><a href="visualize.html#prerequisites-2"><i class="fa fa-check"></i><b>8.2.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="visualize.html"><a href="visualize.html#first-steps"><i class="fa fa-check"></i><b>8.3</b> First steps</a><ul>
<li class="chapter" data-level="8.3.1" data-path="visualize.html"><a href="visualize.html#the-mpg-data-frame"><i class="fa fa-check"></i><b>8.3.1</b> The <code>mpg</code> data frame</a></li>
<li class="chapter" data-level="8.3.2" data-path="visualize.html"><a href="visualize.html#creating-a-ggplot"><i class="fa fa-check"></i><b>8.3.2</b> Creating a ggplot</a></li>
<li class="chapter" data-level="8.3.3" data-path="visualize.html"><a href="visualize.html#a-graphing-template"><i class="fa fa-check"></i><b>8.3.3</b> A graphing template</a></li>
<li class="chapter" data-level="8.3.4" data-path="visualize.html"><a href="visualize.html#exercises-2"><i class="fa fa-check"></i><b>8.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="visualize.html"><a href="visualize.html#aesthetic-mappings"><i class="fa fa-check"></i><b>8.4</b> Aesthetic mappings</a><ul>
<li class="chapter" data-level="8.4.1" data-path="visualize.html"><a href="visualize.html#exercises-3"><i class="fa fa-check"></i><b>8.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="visualize.html"><a href="visualize.html#common-problems"><i class="fa fa-check"></i><b>8.5</b> Common problems</a></li>
<li class="chapter" data-level="8.6" data-path="visualize.html"><a href="visualize.html#facets"><i class="fa fa-check"></i><b>8.6</b> Facets</a><ul>
<li class="chapter" data-level="8.6.1" data-path="visualize.html"><a href="visualize.html#exercises-4"><i class="fa fa-check"></i><b>8.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="visualize.html"><a href="visualize.html#geometric-objects"><i class="fa fa-check"></i><b>8.7</b> Geometric objects</a><ul>
<li class="chapter" data-level="8.7.1" data-path="visualize.html"><a href="visualize.html#exercises-5"><i class="fa fa-check"></i><b>8.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="visualize.html"><a href="visualize.html#statistical-transformations"><i class="fa fa-check"></i><b>8.8</b> Statistical transformations</a><ul>
<li class="chapter" data-level="8.8.1" data-path="visualize.html"><a href="visualize.html#exercises-6"><i class="fa fa-check"></i><b>8.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="visualize.html"><a href="visualize.html#position-adjustments"><i class="fa fa-check"></i><b>8.9</b> Position adjustments</a><ul>
<li class="chapter" data-level="8.9.1" data-path="visualize.html"><a href="visualize.html#exercises-7"><i class="fa fa-check"></i><b>8.9.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="visualize.html"><a href="visualize.html#coordinate-systems"><i class="fa fa-check"></i><b>8.10</b> Coordinate systems</a><ul>
<li class="chapter" data-level="8.10.1" data-path="visualize.html"><a href="visualize.html#exercises-8"><i class="fa fa-check"></i><b>8.10.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="visualize.html"><a href="visualize.html#the-layered-grammar-of-graphics"><i class="fa fa-check"></i><b>8.11</b> The layered grammar of graphics</a></li>
<li class="chapter" data-level="8.12" data-path="visualize.html"><a href="visualize.html#learn-more-3"><i class="fa fa-check"></i><b>8.12</b> Learn More</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html"><i class="fa fa-check"></i><b>9</b> Model with Split-Apply-Combine Strategy</a><ul>
<li class="chapter" data-level="9.1" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#readings-7"><i class="fa fa-check"></i><b>9.1</b> Readings</a></li>
<li class="chapter" data-level="9.2" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#think-before-you-create-excerpts-of-your-data-1"><i class="fa fa-check"></i><b>9.2</b> Think before you create excerpts of your data …</a><ul>
<li class="chapter" data-level="9.2.1" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#load-dplyr-tidyr-purrr-and-gapminder"><i class="fa fa-check"></i><b>9.2.1</b> Load dplyr, tidyr, purrr and gapminder</a></li>
<li class="chapter" data-level="9.2.2" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#split-apply-combine"><i class="fa fa-check"></i><b>9.2.2</b> Split Apply Combine</a></li>
<li class="chapter" data-level="9.2.3" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#entry-level-dplyrgroup_by"><i class="fa fa-check"></i><b>9.2.3</b> Entry level: <code>dplyr::group_by()</code></a></li>
<li class="chapter" data-level="9.2.4" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#general-approach-nesting"><i class="fa fa-check"></i><b>9.2.4</b> General approach: nesting</a></li>
<li class="chapter" data-level="9.2.5" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#apply-a-function-purrrmap-and-mutate"><i class="fa fa-check"></i><b>9.2.5</b> Apply a function <code>purrr::map()</code> and <code>mutate()</code></a></li>
<li class="chapter" data-level="9.2.6" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#always-have-an-exit-strategy"><i class="fa fa-check"></i><b>9.2.6</b> Always have an exit strategy</a></li>
<li class="chapter" data-level="9.2.7" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#simplify-and-combine"><i class="fa fa-check"></i><b>9.2.7</b> Simplify and combine</a></li>
<li class="chapter" data-level="9.2.8" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#recap"><i class="fa fa-check"></i><b>9.2.8</b> Recap</a></li>
<li class="chapter" data-level="9.2.9" data-path="model-with-split-apply-combine-strategy.html"><a href="model-with-split-apply-combine-strategy.html#enjoy-the-payoff-of-your-work"><i class="fa fa-check"></i><b>9.2.9</b> Enjoy the payoff of your work</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>10</b> RMarkdown</a><ul>
<li class="chapter" data-level="10.1" data-path="rmarkdown.html"><a href="rmarkdown.html#readings-8"><i class="fa fa-check"></i><b>10.1</b> Readings</a></li>
<li class="chapter" data-level="10.2" data-path="rmarkdown.html"><a href="rmarkdown.html#overview"><i class="fa fa-check"></i><b>10.2</b> Overview</a></li>
<li class="chapter" data-level="10.3" data-path="rmarkdown.html"><a href="rmarkdown.html#step-0-software-installation-and-configuration"><i class="fa fa-check"></i><b>10.3</b> Step 0: Software installation and configuration</a></li>
<li class="chapter" data-level="10.4" data-path="rmarkdown.html"><a href="rmarkdown.html#step-1-get-ready-to-work"><i class="fa fa-check"></i><b>10.4</b> Step 1: Get ready to work</a></li>
<li class="chapter" data-level="10.5" data-path="rmarkdown.html"><a href="rmarkdown.html#step-2-practice-with-rstudios-boilerplate-r-markdown-document"><i class="fa fa-check"></i><b>10.5</b> Step 2: Practice with RStudio’s boilerplate R Markdown document</a></li>
<li class="chapter" data-level="10.6" data-path="rmarkdown.html"><a href="rmarkdown.html#step-3-take-control-of-the-output-format"><i class="fa fa-check"></i><b>10.6</b> Step 3: Take control of the output format</a></li>
<li class="chapter" data-level="10.7" data-path="rmarkdown.html"><a href="rmarkdown.html#step-4-swap-out-the-guts-of-the-document"><i class="fa fa-check"></i><b>10.7</b> Step 4: Swap out the “guts” of the document</a></li>
<li class="chapter" data-level="10.8" data-path="rmarkdown.html"><a href="rmarkdown.html#step-5-develop-your-report"><i class="fa fa-check"></i><b>10.8</b> Step 5: Develop your report</a></li>
<li class="chapter" data-level="10.9" data-path="rmarkdown.html"><a href="rmarkdown.html#step-6-publish-your-report"><i class="fa fa-check"></i><b>10.9</b> Step 6: Publish your report</a><ul>
<li class="chapter" data-level="10.9.1" data-path="rmarkdown.html"><a href="rmarkdown.html#html-on-github"><i class="fa fa-check"></i><b>10.9.1</b> HTML on GitHub</a></li>
</ul></li>
<li class="chapter" data-level="10.10" data-path="rmarkdown.html"><a href="rmarkdown.html#troubleshooting"><i class="fa fa-check"></i><b>10.10</b> Troubleshooting</a></li>
<li class="chapter" data-level="10.11" data-path="rmarkdown.html"><a href="rmarkdown.html#learn-more-4"><i class="fa fa-check"></i><b>10.11</b> Learn More</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>11</b> Resources</a><ul>
<li class="chapter" data-level="11.1" data-path="resources.html"><a href="resources.html#where-to-go-from-here"><i class="fa fa-check"></i><b>11.1</b> Where to go from here</a><ul>
<li class="chapter" data-level="11.1.1" data-path="resources.html"><a href="resources.html#automate-testing-your-code"><i class="fa fa-check"></i><b>11.1.1</b> Automate testing your code</a></li>
<li class="chapter" data-level="11.1.2" data-path="resources.html"><a href="resources.html#automate-your-workflow"><i class="fa fa-check"></i><b>11.1.2</b> Automate your workflow</a></li>
<li class="chapter" data-level="11.1.3" data-path="resources.html"><a href="resources.html#share-your-work-as-a-r-package"><i class="fa fa-check"></i><b>11.1.3</b> Share your work as a R package</a></li>
<li class="chapter" data-level="11.1.4" data-path="resources.html"><a href="resources.html#develop-interactive-apps-with-shiny"><i class="fa fa-check"></i><b>11.1.4</b> Develop interactive apps with Shiny</a></li>
<li class="chapter" data-level="11.1.5" data-path="resources.html"><a href="resources.html#where-to-go-from-here-1"><i class="fa fa-check"></i><b>11.1.5</b> Where to go from here</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="resources.html"><a href="resources.html#where-to-find-help"><i class="fa fa-check"></i><b>11.2</b> Where to find help</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Science for Transportation Researchers, Planners, and Engineers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="transform-with-dplyr" class="section level1">
<h1><span class="header-section-number">7</span> Transform with dplyr</h1>
<div id="readings-5" class="section level2">
<h2><span class="header-section-number">7.1</span> Readings</h2>
<ol style="list-style-type: decimal">
<li><a href="http://r4ds.had.co.nz/transform.html">R4DS Data Transformation</a></li>
<li><a href="http://r4ds.had.co.nz/relational-data.html">R4DS Relational data</a></li>
</ol>
</div>
<div id="prerequisites-1" class="section level2">
<h2><span class="header-section-number">7.2</span> Prerequisites</h2>
<p>Load <code>dplyr</code> (or <code>tidyverse</code>, which will load <code>dplyr</code>) and <code>gapminder</code> (install it if not yet installed):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gapminder)
<span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr</code></pre>
<pre><code>## Conflicts with tidy packages ----------------------------------------------</code></pre>
<pre><code>## filter(): dplyr, stats
## lag():    dplyr, stats</code></pre>
</div>
<div id="dplyr-introduction" class="section level2">
<h2><span class="header-section-number">7.3</span> dplyr introduction</h2>
<p><code>dplyr</code> is a package for data manipulation, developed by Hadley Wickham and Romain Francois. It is built to be fast, highly expressive, and open-minded about how your data is stored. It is installed as part of the the <a href="https://github.com/hadley/tidyverse"><code>tidyverse</code></a> meta-package and, as a core package, it is among those loaded via <code>library(tidyverse)</code>.</p>
<p><code>dplyr</code>’s roots are in an earlier package called <a href="http://plyr.had.co.nz"><code>plyr</code></a>, which implements the <a href="https://www.jstatsoft.org/article/view/v040i01">“split-apply-combine” strategy for data analysis</a> (PDF). Where <code>plyr</code> covers a diverse set of inputs and outputs (e.g., arrays, data frames, lists), <code>dplyr</code> has a laser-like focus on data frames or, in the <code>tidyverse</code>, “tibbles”. <code>dplyr</code> is a package-level treament of the <code>ddply()</code> function from <code>plyr</code>, because “data frame in, data frame out” proved to be so incredibly important.</p>
<p>Have no idea what I’m talking about? Not sure if you care? If you use these base R functions: <code>subset()</code>, <code>apply()</code>, <code>[sl]apply()</code>, <code>tapply()</code>, <code>aggregate()</code>, <code>split()</code>, <code>do.call()</code>, <code>with()</code>, <code>within()</code>, then you should keep reading. Also, if you use <code>for()</code> loops alot, you might enjoy learning other ways to iterate over rows or groups of rows or variables in a data frame.</p>
<div id="say-hello-to-the-gapminder-tibble" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Say hello to the Gapminder tibble</h3>
<p>The <code>gapminder</code> data frame is a special kind of data frame: a tibble.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder</code></pre></div>
<pre><code>## # A tibble: 1,704 x 6
##        country continent  year lifeExp      pop gdpPercap
##         &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan      Asia  1952  28.801  8425333  779.4453
##  2 Afghanistan      Asia  1957  30.332  9240934  820.8530
##  3 Afghanistan      Asia  1962  31.997 10267083  853.1007
##  4 Afghanistan      Asia  1967  34.020 11537966  836.1971
##  5 Afghanistan      Asia  1972  36.088 13079460  739.9811
##  6 Afghanistan      Asia  1977  38.438 14880372  786.1134
##  7 Afghanistan      Asia  1982  39.854 12881816  978.0114
##  8 Afghanistan      Asia  1987  40.822 13867957  852.3959
##  9 Afghanistan      Asia  1992  41.674 16317921  649.3414
## 10 Afghanistan      Asia  1997  41.763 22227415  635.3414
## # ... with 1,694 more rows</code></pre>
<p>It’s tibble-ness is why we get nice compact printing. For a reminder of the problems with base data frame printing, go type <code>iris</code> in the R Console or, better yet, print a data frame to screen that has lots of columns.</p>
<p>Note how gapminder’s <code>class()</code> includes <code>tbl_df</code>; the “tibble” terminology is a nod to this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(gapminder)</code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>There will be some functions, like <code>print()</code>, that know about tibbles and do something special. There will others that do not, like <code>summary()</code>. In which case the regular data frame treatment will happen, because every tibble is also a regular data frame.</p>
<p>To turn any data frame into a tibble use <code>as_tibble()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris)</code></pre></div>
<pre><code>## # A tibble: 150 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;  &lt;fctr&gt;
##  1          5.1         3.5          1.4         0.2  setosa
##  2          4.9         3.0          1.4         0.2  setosa
##  3          4.7         3.2          1.3         0.2  setosa
##  4          4.6         3.1          1.5         0.2  setosa
##  5          5.0         3.6          1.4         0.2  setosa
##  6          5.4         3.9          1.7         0.4  setosa
##  7          4.6         3.4          1.4         0.3  setosa
##  8          5.0         3.4          1.5         0.2  setosa
##  9          4.4         2.9          1.4         0.2  setosa
## 10          4.9         3.1          1.5         0.1  setosa
## # ... with 140 more rows</code></pre>
</div>
<div id="think-before-you-create-excerpts-of-your-data" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Think before you create excerpts of your data …</h3>
<p>If you feel the urge to store a little snippet of your data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(canada &lt;-<span class="st"> </span>gapminder[<span class="dv">241</span>:<span class="dv">252</span>, ])</code></pre></div>
<pre><code>## # A tibble: 12 x 6
##    country continent  year lifeExp      pop gdpPercap
##     &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1  Canada  Americas  1952  68.750 14785584  11367.16
##  2  Canada  Americas  1957  69.960 17010154  12489.95
##  3  Canada  Americas  1962  71.300 18985849  13462.49
##  4  Canada  Americas  1967  72.130 20819767  16076.59
##  5  Canada  Americas  1972  72.880 22284500  18970.57
##  6  Canada  Americas  1977  74.210 23796400  22090.88
##  7  Canada  Americas  1982  75.760 25201900  22898.79
##  8  Canada  Americas  1987  76.860 26549700  26626.52
##  9  Canada  Americas  1992  77.950 28523502  26342.88
## 10  Canada  Americas  1997  78.610 30305843  28954.93
## 11  Canada  Americas  2002  79.770 31902268  33328.97
## 12  Canada  Americas  2007  80.653 33390141  36319.24</code></pre>
<p>Stop and ask yourself …</p>
<blockquote>
<p>Do I want to create mini datasets for each level of some factor (or unique combination of several factors) … in order to compute or graph something?</p>
</blockquote>
<p>If YES, <strong>use proper data aggregation techniques</strong> or facetting in <code>ggplot2</code> – <strong>don’t subset the data</strong>. Or, more realistic, only subset the data as a temporary measure while you develop your elegant code for computing on or visualizing these data subsets.</p>
<p>If NO, then maybe you really do need to store a copy of a subset of the data. But seriously consider whether you can achieve your goals by simply using the <code>subset =</code> argument of, e.g., the <code>lm()</code> function, to limit computation to your excerpt of choice. Lots of functions offer a <code>subset =</code> argument!</p>
<p>Copies and excerpts of your data clutter your workspace, invite mistakes, and sow general confusion. Avoid whenever possible.</p>
<p>Reality can also lie somewhere in between. You will find the workflows presented below can help you accomplish your goals with minimal creation of temporary, intermediate objects.</p>
</div>
<div id="use-filter-to-subset-data-row-wise." class="section level3">
<h3><span class="header-section-number">7.3.3</span> Use <code>filter()</code> to subset data row-wise.</h3>
<p><code>filter()</code> takes logical expressions and returns the rows for which all are <code>TRUE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, lifeExp &lt;<span class="st"> </span><span class="dv">29</span>)</code></pre></div>
<pre><code>## # A tibble: 2 x 6
##       country continent  year lifeExp     pop gdpPercap
##        &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
## 1 Afghanistan      Asia  1952  28.801 8425333  779.4453
## 2      Rwanda    Africa  1992  23.599 7290203  737.0686</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, country ==<span class="st"> &quot;Rwanda&quot;</span>, year &gt;<span class="st"> </span><span class="dv">1979</span>)</code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   country continent  year lifeExp     pop gdpPercap
##    &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
## 1  Rwanda    Africa  1982  46.218 5507565  881.5706
## 2  Rwanda    Africa  1987  44.020 6349365  847.9912
## 3  Rwanda    Africa  1992  23.599 7290203  737.0686
## 4  Rwanda    Africa  1997  36.087 7212583  589.9445
## 5  Rwanda    Africa  2002  43.413 7852401  785.6538
## 6  Rwanda    Africa  2007  46.242 8860588  863.0885</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, country %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Rwanda&quot;</span>, <span class="st">&quot;Afghanistan&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 24 x 6
##        country continent  year lifeExp      pop gdpPercap
##         &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan      Asia  1952  28.801  8425333  779.4453
##  2 Afghanistan      Asia  1957  30.332  9240934  820.8530
##  3 Afghanistan      Asia  1962  31.997 10267083  853.1007
##  4 Afghanistan      Asia  1967  34.020 11537966  836.1971
##  5 Afghanistan      Asia  1972  36.088 13079460  739.9811
##  6 Afghanistan      Asia  1977  38.438 14880372  786.1134
##  7 Afghanistan      Asia  1982  39.854 12881816  978.0114
##  8 Afghanistan      Asia  1987  40.822 13867957  852.3959
##  9 Afghanistan      Asia  1992  41.674 16317921  649.3414
## 10 Afghanistan      Asia  1997  41.763 22227415  635.3414
## # ... with 14 more rows</code></pre>
<p>Compare with some base R code to accomplish the same things</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder[gapminder$lifeExp &lt;<span class="st"> </span><span class="dv">29</span>, ] ## repeat `gapminder`, [i, j] indexing is distracting
<span class="kw">subset</span>(gapminder, country ==<span class="st"> &quot;Rwanda&quot;</span>) ## almost same as filter; quite nice actually</code></pre></div>
<p>Under no circumstances should you subset your data the way I did at first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">excerpt &lt;-<span class="st"> </span>gapminder[<span class="dv">241</span>:<span class="dv">252</span>, ]</code></pre></div>
<p>Why is this a terrible idea?</p>
<ul>
<li>It is not self-documenting. What is so special about rows 241 through 252?</li>
<li>It is fragile. This line of code will produce different results if someone changes the row order of <code>gapminder</code>, e.g. sorts the data earlier in the script.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, country ==<span class="st"> &quot;Canada&quot;</span>)</code></pre></div>
<p>This call explains itself and is fairly robust.</p>
</div>
<div id="meet-the-new-pipe-operator" class="section level3">
<h3><span class="header-section-number">7.3.4</span> Meet the new pipe operator</h3>
<p>Before we go any further, we should exploit the new pipe operator that the tidyverse imports from the <a href="https://github.com/smbache/magrittr"><code>magrittr</code></a> package by Stefan Bache. This is going to change your data analytical life. You no longer need to enact multi-operation commands by nesting them inside each other, like so many <a href="http://blogue.us/wp-content/uploads/2009/07/Unknown-21.jpeg">Russian nesting dolls</a>. This new syntax leads to code that is much easier to write and to read.</p>
<p>Here’s what it looks like: <code>%&gt;%</code>. The RStudio keyboard shortcut: Ctrl + Shift + M (Windows), Cmd + Shift + M (Mac).</p>
<p>Let’s demo then I’ll explain:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%<span class="st"> </span><span class="kw">head</span>()</code></pre></div>
<pre><code>## # A tibble: 6 x 6
##       country continent  year lifeExp      pop gdpPercap
##        &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Afghanistan      Asia  1952  28.801  8425333  779.4453
## 2 Afghanistan      Asia  1957  30.332  9240934  820.8530
## 3 Afghanistan      Asia  1962  31.997 10267083  853.1007
## 4 Afghanistan      Asia  1967  34.020 11537966  836.1971
## 5 Afghanistan      Asia  1972  36.088 13079460  739.9811
## 6 Afghanistan      Asia  1977  38.438 14880372  786.1134</code></pre>
<p>This is equivalent to <code>head(gapminder)</code>. The pipe operator takes the thing on the left-hand-side and <strong>pipes</strong> it into the function call on the right-hand-side – literally, drops it in as the first argument.</p>
<p>Never fear, you can still specify other arguments to this function! To see the first 3 rows of Gapminder, we could say <code>head(gapminder, 3)</code> or this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%<span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 6
##       country continent  year lifeExp      pop gdpPercap
##        &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Afghanistan      Asia  1952  28.801  8425333  779.4453
## 2 Afghanistan      Asia  1957  30.332  9240934  820.8530
## 3 Afghanistan      Asia  1962  31.997 10267083  853.1007</code></pre>
<p>I’ve advised you to think “gets” whenever you see the assignment operator, <code>&lt;-</code>. Similary, you should think “then” whenever you see the pipe operator, <code>%&gt;%</code>.</p>
<p>You are probably not impressed yet, but the magic will soon happen.</p>
</div>
<div id="use-select-to-subset-the-data-on-variables-or-columns." class="section level3">
<h3><span class="header-section-number">7.3.5</span> Use <code>select()</code> to subset the data on variables or columns.</h3>
<p>Back to <code>dplyr</code> …</p>
<p>Use <code>select()</code> to subset the data on variables or columns. Here’s a conventional call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(gapminder, year, lifeExp)</code></pre></div>
<pre><code>## # A tibble: 1,704 x 2
##     year lifeExp
##    &lt;int&gt;   &lt;dbl&gt;
##  1  1952  28.801
##  2  1957  30.332
##  3  1962  31.997
##  4  1967  34.020
##  5  1972  36.088
##  6  1977  38.438
##  7  1982  39.854
##  8  1987  40.822
##  9  1992  41.674
## 10  1997  41.763
## # ... with 1,694 more rows</code></pre>
<p>And here’s the same operation, but written with the pipe operator and piped through <code>head()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%
<span class="st">  </span><span class="kw">select</span>(year, lifeExp) %&gt;%
<span class="st">  </span><span class="kw">head</span>(<span class="dv">4</span>)</code></pre></div>
<pre><code>## # A tibble: 4 x 2
##    year lifeExp
##   &lt;int&gt;   &lt;dbl&gt;
## 1  1952  28.801
## 2  1957  30.332
## 3  1962  31.997
## 4  1967  34.020</code></pre>
<p>Think: “Take <code>gapminder</code>, then select the variables year and lifeExp, then show the first 4 rows.”</p>
</div>
<div id="revel-in-the-convenience" class="section level3">
<h3><span class="header-section-number">7.3.6</span> Revel in the convenience</h3>
<p>Here’s the data for Cambodia, but only certain variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Cambodia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(year, lifeExp)</code></pre></div>
<pre><code>## # A tibble: 12 x 2
##     year lifeExp
##    &lt;int&gt;   &lt;dbl&gt;
##  1  1952  39.417
##  2  1957  41.366
##  3  1962  43.415
##  4  1967  45.415
##  5  1972  40.317
##  6  1977  31.220
##  7  1982  50.957
##  8  1987  53.914
##  9  1992  55.803
## 10  1997  56.534
## 11  2002  56.752
## 12  2007  59.723</code></pre>
<p>and what a typical base R call would look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder[gapminder$country ==<span class="st"> &quot;Cambodia&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;lifeExp&quot;</span>)]</code></pre></div>
<pre><code>## # A tibble: 12 x 2
##     year lifeExp
##    &lt;int&gt;   &lt;dbl&gt;
##  1  1952  39.417
##  2  1957  41.366
##  3  1962  43.415
##  4  1967  45.415
##  5  1972  40.317
##  6  1977  31.220
##  7  1982  50.957
##  8  1987  53.914
##  9  1992  55.803
## 10  1997  56.534
## 11  2002  56.752
## 12  2007  59.723</code></pre>
</div>
<div id="pure-predictable-pipeable" class="section level3">
<h3><span class="header-section-number">7.3.7</span> Pure, predictable, pipeable</h3>
<p>We’ve barely scratched the surface of <code>dplyr</code> but I want to point out key principles you may start to appreciate. If you’re new to R or “programming with data”, feel free skip this section and <a href="block010_dplyr-end-single-table.html">move on</a>.</p>
<p><code>dplyr</code>’s verbs, such as <code>filter()</code> and <code>select()</code>, are what’s called <a href="http://en.wikipedia.org/wiki/Pure_function">pure functions</a>. To quote from Wickham’s <a href="http://adv-r.had.co.nz/Functions.html">Advanced R Programming book</a>:</p>
<blockquote>
<p>The functions that are the easiest to understand and reason about are pure functions: functions that always map the same input to the same output and have no other impact on the workspace. In other words, pure functions have no side effects: they don’t affect the state of the world in any way apart from the value they return.</p>
</blockquote>
<p>In fact, these verbs are a special case of pure functions: they take the same flavor of object as input and output. Namely, a data frame or one of the other data receptacles <code>dplyr</code> supports.</p>
<p>And finally, the data is <strong>always</strong> the very first argument of the verb functions.</p>
<p>This set of deliberate design choices, together with the new pipe operator, produces a highly effective, low friction <a href="http://adv-r.had.co.nz/dsl.html">domain-specific language</a> for data analysis.</p>
<p>Go to the next block, <a href="block010_dplyr-end-single-table.html"><code>dplyr</code> functions for a single dataset</a>, for more <code>dplyr</code>!</p>
</div>
</div>
<div id="dplyr-grammar" class="section level2">
<h2><span class="header-section-number">7.4</span> dplyr grammar</h2>
<div id="create-a-copy-of-gapminder" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Create a copy of gapminder</h3>
<p>We’re going to make changes to the <code>gapminder</code> tibble. To eliminate any fear that you’re damaging the data that comes with the package, we create an explicit copy of <code>gapminder</code> for our experiments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(my_gap &lt;-<span class="st"> </span>gapminder)</code></pre></div>
<pre><code>## # A tibble: 1,704 x 6
##        country continent  year lifeExp      pop gdpPercap
##         &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan      Asia  1952  28.801  8425333  779.4453
##  2 Afghanistan      Asia  1957  30.332  9240934  820.8530
##  3 Afghanistan      Asia  1962  31.997 10267083  853.1007
##  4 Afghanistan      Asia  1967  34.020 11537966  836.1971
##  5 Afghanistan      Asia  1972  36.088 13079460  739.9811
##  6 Afghanistan      Asia  1977  38.438 14880372  786.1134
##  7 Afghanistan      Asia  1982  39.854 12881816  978.0114
##  8 Afghanistan      Asia  1987  40.822 13867957  852.3959
##  9 Afghanistan      Asia  1992  41.674 16317921  649.3414
## 10 Afghanistan      Asia  1997  41.763 22227415  635.3414
## # ... with 1,694 more rows</code></pre>
<p><strong>Pay close attention</strong> to when we evaluate statements but let the output just print to screen:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## let output print to screen, but do not store
my_gap %&gt;%<span class="st"> </span><span class="kw">filter</span>(country ==<span class="st"> &quot;United States&quot;</span>)</code></pre></div>
<p>… versus when we assign the output to an object, possibly overwriting an existing object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## store the output as an R object
us &lt;-<span class="st"> </span>my_gap %&gt;%<span class="st"> </span><span class="kw">filter</span>(country ==<span class="st"> &quot;United States&quot;</span>)</code></pre></div>
</div>
<div id="use-mutate-to-add-new-variables" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Use <code>mutate()</code> to add new variables</h3>
<p>Imagine we wanted to recover each country’s GDP. After all, the Gapminder data has a variable for population and GDP per capita. Let’s multiply them together.</p>
<p><code>mutate()</code> is a function that defines and inserts new variables into a tibble. You can refer to existing variables by name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap)</code></pre></div>
<pre><code>## # A tibble: 1,704 x 7
##        country continent  year lifeExp      pop gdpPercap         gdp
##         &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1 Afghanistan      Asia  1952  28.801  8425333  779.4453  6567086330
##  2 Afghanistan      Asia  1957  30.332  9240934  820.8530  7585448670
##  3 Afghanistan      Asia  1962  31.997 10267083  853.1007  8758855797
##  4 Afghanistan      Asia  1967  34.020 11537966  836.1971  9648014150
##  5 Afghanistan      Asia  1972  36.088 13079460  739.9811  9678553274
##  6 Afghanistan      Asia  1977  38.438 14880372  786.1134 11697659231
##  7 Afghanistan      Asia  1982  39.854 12881816  978.0114 12598563401
##  8 Afghanistan      Asia  1987  40.822 13867957  852.3959 11820990309
##  9 Afghanistan      Asia  1992  41.674 16317921  649.3414 10595901589
## 10 Afghanistan      Asia  1997  41.763 22227415  635.3414 14121995875
## # ... with 1,694 more rows</code></pre>
<p>Hmmmm … those GDP numbers are almost uselessly large and abstract. Consider the <a href="http://fivethirtyeight.com/datalab/xkcd-randall-munroe-qanda-what-if/">advice of Randall Munroe of xkcd</a>:</p>
<blockquote>
<p>One thing that bothers me is large numbers presented without context… ‘If I added a zero to this number, would the sentence containing it mean something different to me?’ If the answer is ‘no,’ maybe the number has no business being in the sentence in the first place.&quot;</p>
</blockquote>
<p>Maybe it would be more meaningful to consumers of my tables and figures to stick with GDP per capita. But what if I reported GDP per capita, relative to some a benchmark country.</p>
<p>I need to create a new variable that is <code>gdpPercap</code> divided by Canadian <code>gdpPercap</code>, taking care that I always divide two numbers that pertain to the same year.</p>
<p>How I achieve:</p>
<ul>
<li>Filter down to the rows for Canada</li>
<li>Create a new temporary variable in <code>my_gap</code>:
<ul>
<li>Extract the <code>gdpPercap</code> variable from the Canadian data.</li>
<li>Replicate it once per country in the dataset, so it has the right length.</li>
</ul></li>
<li>Divide raw <code>gdpPercap</code> by this Canadian figure.</li>
<li>Discard the temporary variable of replicated Canadian <code>gdpPercap</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctib &lt;-<span class="st"> </span>my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Canada&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(year, <span class="dt">BasegdpPercap=</span>gdpPercap)
ctib</code></pre></div>
<pre><code>## # A tibble: 12 x 2
##     year BasegdpPercap
##    &lt;int&gt;         &lt;dbl&gt;
##  1  1952      11367.16
##  2  1957      12489.95
##  3  1962      13462.49
##  4  1967      16076.59
##  5  1972      18970.57
##  6  1977      22090.88
##  7  1982      22898.79
##  8  1987      26626.52
##  9  1992      26342.88
## 10  1997      28954.93
## 11  2002      33328.97
## 12  2007      36319.24</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap &lt;-<span class="st"> </span>my_gap %&gt;%
<span class="st">  </span><span class="kw">inner_join</span>(ctib, <span class="dt">by=</span><span class="st">&quot;year&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdpPercapRel =</span> gdpPercap /<span class="st"> </span>BasegdpPercap,
         <span class="dt">BasegdpPercap =</span> <span class="ot">NULL</span>)
my_gap</code></pre></div>
<pre><code>## # A tibble: 1,704 x 7
##        country continent  year lifeExp      pop gdpPercap gdpPercapRel
##         &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afghanistan      Asia  1952  28.801  8425333  779.4453   0.06856992
##  2 Afghanistan      Asia  1957  30.332  9240934  820.8530   0.06572108
##  3 Afghanistan      Asia  1962  31.997 10267083  853.1007   0.06336874
##  4 Afghanistan      Asia  1967  34.020 11537966  836.1971   0.05201335
##  5 Afghanistan      Asia  1972  36.088 13079460  739.9811   0.03900679
##  6 Afghanistan      Asia  1977  38.438 14880372  786.1134   0.03558542
##  7 Afghanistan      Asia  1982  39.854 12881816  978.0114   0.04271018
##  8 Afghanistan      Asia  1987  40.822 13867957  852.3959   0.03201305
##  9 Afghanistan      Asia  1992  41.674 16317921  649.3414   0.02464959
## 10 Afghanistan      Asia  1997  41.763 22227415  635.3414   0.02194243
## # ... with 1,694 more rows</code></pre>
<p>Note that, <code>mutate()</code> builds new variables sequentially so you can reference earlier ones (like <code>tmp</code>) when defining later ones (like <code>gdpPercapRel</code>). Also, you can get rid of a variable by setting it to <code>NULL</code>.</p>
<p>How could we sanity check that this worked? The Canadian values for <code>gdpPercapRel</code> better all be 1!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Canada&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(country, year, gdpPercapRel)</code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    country  year gdpPercapRel
##     &lt;fctr&gt; &lt;int&gt;        &lt;dbl&gt;
##  1  Canada  1952            1
##  2  Canada  1957            1
##  3  Canada  1962            1
##  4  Canada  1967            1
##  5  Canada  1972            1
##  6  Canada  1977            1
##  7  Canada  1982            1
##  8  Canada  1987            1
##  9  Canada  1992            1
## 10  Canada  1997            1
## 11  Canada  2002            1
## 12  Canada  2007            1</code></pre>
<p>I perceive Canada to be a “high GDP” country, so I predict that the distribution of <code>gdpPercapRel</code> is located below 1, possibly even well below. Check your intuition!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(my_gap$gdpPercapRel)</code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.007236 0.061648 0.171521 0.326659 0.446564 9.534690</code></pre>
<p>The relative GDP per capita numbers are, in general, well below 1. We see that most of the countries covered by this dataset have substantially lower GDP per capita, relative to Canada, across the entire time period.</p>
<p>Remember: Trust No One. Including (especially?) yourself. Always try to find a way to check that you’ve done what meant to. Prepare to be horrified.</p>
</div>
<div id="use-arrange-to-row-order-data-in-a-principled-way" class="section level3">
<h3><span class="header-section-number">7.4.3</span> Use <code>arrange()</code> to row-order data in a principled way</h3>
<p><code>arrange()</code> reorders the rows in a data frame. Imagine you wanted this data ordered by year then country, as opposed to by country then year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(year, country)</code></pre></div>
<pre><code>## # A tibble: 1,704 x 7
##        country continent  year lifeExp      pop  gdpPercap gdpPercapRel
##         &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afghanistan      Asia  1952  28.801  8425333   779.4453   0.06856992
##  2     Albania    Europe  1952  55.230  1282697  1601.0561   0.14084925
##  3     Algeria    Africa  1952  43.077  9279525  2449.0082   0.21544589
##  4      Angola    Africa  1952  30.015  4232095  3520.6103   0.30971764
##  5   Argentina  Americas  1952  62.485 17876956  5911.3151   0.52003442
##  6   Australia   Oceania  1952  69.120  8691212 10039.5956   0.88321046
##  7     Austria    Europe  1952  66.800  6927772  6137.0765   0.53989527
##  8     Bahrain      Asia  1952  50.939   120447  9867.0848   0.86803421
##  9  Bangladesh      Asia  1952  37.484 46886859   684.2442   0.06019482
## 10     Belgium    Europe  1952  68.000  8730405  8343.1051   0.73396559
## # ... with 1,694 more rows</code></pre>
<p>Or maybe you want just the data from 2007, sorted on life expectancy?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(year ==<span class="st"> </span><span class="dv">2007</span>) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(lifeExp)</code></pre></div>
<pre><code>## # A tibble: 142 x 7
##                     country continent  year lifeExp      pop gdpPercap
##                      &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1                Swaziland    Africa  2007  39.613  1133066 4513.4806
##  2               Mozambique    Africa  2007  42.082 19951656  823.6856
##  3                   Zambia    Africa  2007  42.384 11746035 1271.2116
##  4             Sierra Leone    Africa  2007  42.568  6144562  862.5408
##  5                  Lesotho    Africa  2007  42.592  2012649 1569.3314
##  6                   Angola    Africa  2007  42.731 12420476 4797.2313
##  7                 Zimbabwe    Africa  2007  43.487 12311143  469.7093
##  8              Afghanistan      Asia  2007  43.828 31889923  974.5803
##  9 Central African Republic    Africa  2007  44.741  4369038  706.0165
## 10                  Liberia    Africa  2007  45.678  3193942  414.5073
## # ... with 132 more rows, and 1 more variables: gdpPercapRel &lt;dbl&gt;</code></pre>
<p>Oh, you’d like to sort on life expectancy in <strong>desc</strong>ending order? Then use <code>desc()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(year ==<span class="st"> </span><span class="dv">2007</span>) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lifeExp))</code></pre></div>
<pre><code>## # A tibble: 142 x 7
##             country continent  year lifeExp       pop gdpPercap
##              &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1            Japan      Asia  2007  82.603 127467972  31656.07
##  2 Hong Kong, China      Asia  2007  82.208   6980412  39724.98
##  3          Iceland    Europe  2007  81.757    301931  36180.79
##  4      Switzerland    Europe  2007  81.701   7554661  37506.42
##  5        Australia   Oceania  2007  81.235  20434176  34435.37
##  6            Spain    Europe  2007  80.941  40448191  28821.06
##  7           Sweden    Europe  2007  80.884   9031088  33859.75
##  8           Israel      Asia  2007  80.745   6426679  25523.28
##  9           France    Europe  2007  80.657  61083916  30470.02
## 10           Canada  Americas  2007  80.653  33390141  36319.24
## # ... with 132 more rows, and 1 more variables: gdpPercapRel &lt;dbl&gt;</code></pre>
<p>I advise that your analyses NEVER rely on rows or variables being in a specific order. But it’s still true that human beings write the code and the interactive development process can be much nicer if you reorder the rows of your data as you go along. Also, once you are preparing tables for human eyeballs, it is imperative that you step up and take control of row order.</p>
</div>
<div id="use-rename-to-rename-variables" class="section level3">
<h3><span class="header-section-number">7.4.4</span> Use <code>rename()</code> to rename variables</h3>
<p>The Gapminder use <a href="http://en.wikipedia.org/wiki/CamelCase"><code>camelCase</code></a> for variable naming, an alternative convention is <a href="http://en.wikipedia.org/wiki/Snake_case"><code>snake_case</code></a>. Let’s rename some variables to use snake case!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">life_exp =</span> lifeExp,
         <span class="dt">gdp_percap =</span> gdpPercap,
         <span class="dt">gdp_percap_rel =</span> gdpPercapRel)</code></pre></div>
<pre><code>## # A tibble: 1,704 x 7
##        country continent  year life_exp      pop gdp_percap gdp_percap_rel
##         &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;
##  1 Afghanistan      Asia  1952   28.801  8425333   779.4453     0.06856992
##  2 Afghanistan      Asia  1957   30.332  9240934   820.8530     0.06572108
##  3 Afghanistan      Asia  1962   31.997 10267083   853.1007     0.06336874
##  4 Afghanistan      Asia  1967   34.020 11537966   836.1971     0.05201335
##  5 Afghanistan      Asia  1972   36.088 13079460   739.9811     0.03900679
##  6 Afghanistan      Asia  1977   38.438 14880372   786.1134     0.03558542
##  7 Afghanistan      Asia  1982   39.854 12881816   978.0114     0.04271018
##  8 Afghanistan      Asia  1987   40.822 13867957   852.3959     0.03201305
##  9 Afghanistan      Asia  1992   41.674 16317921   649.3414     0.02464959
## 10 Afghanistan      Asia  1997   41.763 22227415   635.3414     0.02194243
## # ... with 1,694 more rows</code></pre>
<p>I did NOT assign the post-rename object back to <code>my_gap</code> because that would make the chunks in this tutorial harder to copy/paste and run out of order. In real life, I would probably assign this back to <code>my_gap</code>, in a data preparation script, and proceed with the new variable names.</p>
</div>
<div id="select-can-rename-and-reposition-variables" class="section level3">
<h3><span class="header-section-number">7.4.5</span> <code>select()</code> can rename and reposition variables</h3>
<p>You’ve seen simple use of <code>select()</code>. There are two tricks you might enjoy:</p>
<ol style="list-style-type: decimal">
<li><code>select()</code> can rename the variables you request to keep.</li>
<li><code>select()</code> can be used with <code>everything()</code> to hoist a variable up to the front of the tibble.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Burundi&quot;</span>, year &gt;<span class="st"> </span><span class="dv">1996</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">yr =</span> year, lifeExp, gdpPercap) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(gdpPercap, <span class="kw">everything</span>())</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   gdpPercap    yr lifeExp
##       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1  463.1151  1997  45.326
## 2  446.4035  2002  47.360
## 3  430.0707  2007  49.580</code></pre>
<p><code>everything()</code> is one of several helpers for variable selection. Read its help to see the rest.</p>
</div>
<div id="group_by-is-a-mighty-weapon" class="section level3">
<h3><span class="header-section-number">7.4.6</span> <code>group_by()</code> is a mighty weapon</h3>
<p>I have found <del>friends and family</del> collaborators love to ask seemingly innocuous questions like, “which country experienced the sharpest 5-year drop in life expectancy?”. In fact, that is a totally natural question to ask. But if you are using a language that doesn’t know about data, it’s an incredibly annoying question to answer.</p>
<p>dplyr offers powerful tools to solve this class of problem.</p>
<ul>
<li><code>group_by()</code> adds extra structure to your dataset – grouping information – which lays the groundwork for computations within the groups.</li>
<li><code>summarize()</code> takes a dataset with <span class="math inline">\(n\)</span> observations, computes requested summaries, and returns a dataset with 1 observation.</li>
<li>Window functions take a dataset with <span class="math inline">\(n\)</span> observations and return a dataset with <span class="math inline">\(n\)</span> observations.</li>
<li><code>mutate()</code> and <code>summarize()</code> will honor groups.</li>
<li>You can also do very general computations on your groups with <code>do()</code>, though elsewhere in this course, I advocate for other approaches that I find more intuitive, using the <code>purrr</code> package.</li>
</ul>
<p>Combined with the verbs you already know, these new tools allow you to solve an extremely diverse set of problems with relative ease.</p>
<div id="counting-things-up" class="section level4">
<h4><span class="header-section-number">7.4.6.1</span> Counting things up</h4>
<p>Let’s start with simple counting. How many observations do we have per continent?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(continent) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   continent     n
##      &lt;fctr&gt; &lt;int&gt;
## 1    Africa   624
## 2  Americas   300
## 3      Asia   396
## 4    Europe   360
## 5   Oceania    24</code></pre>
<p>Let us pause here to think about the tidyverse. You could get these same frequencies using <code>table()</code> from base R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(gapminder$continent)</code></pre></div>
<pre><code>## 
##   Africa Americas     Asia   Europe  Oceania 
##      624      300      396      360       24</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(<span class="kw">table</span>(gapminder$continent))</code></pre></div>
<pre><code>##  &#39;table&#39; int [1:5(1d)] 624 300 396 360 24
##  - attr(*, &quot;dimnames&quot;)=List of 1
##   ..$ : chr [1:5] &quot;Africa&quot; &quot;Americas&quot; &quot;Asia&quot; &quot;Europe&quot; ...</code></pre>
<p>But the object of class <code>table</code> that is returned makes downstream computation a bit fiddlier than you’d like. For example, it’s too bad the continent levels come back only as <em>names</em> and not as a proper factor, with the original set of levels. This is an example of how the tidyverse smooths transitions where you want the output of step i to become the input of step i + 1.</p>
<p>The <code>tally()</code> function is a convenience function that knows to count rows. It honors groups.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(continent) %&gt;%
<span class="st">  </span><span class="kw">tally</span>()</code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   continent     n
##      &lt;fctr&gt; &lt;int&gt;
## 1    Africa   624
## 2  Americas   300
## 3      Asia   396
## 4    Europe   360
## 5   Oceania    24</code></pre>
<p>The <code>count()</code> function is an even more convenient function that does both grouping and counting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(continent)</code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   continent     n
##      &lt;fctr&gt; &lt;int&gt;
## 1    Africa   624
## 2  Americas   300
## 3      Asia   396
## 4    Europe   360
## 5   Oceania    24</code></pre>
<p>What if we wanted to add the number of unique countries for each continent? You can compute multiple summaries inside <code>summarize()</code>. Use the <code>n_distinct()</code> function to count the number of distinct countries within each continent.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(continent) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>(),
            <span class="dt">n_countries =</span> <span class="kw">n_distinct</span>(country))</code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   continent     n n_countries
##      &lt;fctr&gt; &lt;int&gt;       &lt;int&gt;
## 1    Africa   624          52
## 2  Americas   300          25
## 3      Asia   396          33
## 4    Europe   360          30
## 5   Oceania    24           2</code></pre>
</div>
<div id="general-summarization" class="section level4">
<h4><span class="header-section-number">7.4.6.2</span> General summarization</h4>
<p>The functions you’ll apply within <code>summarize()</code> include classical statistical summaries, like <code>mean()</code>, <code>median()</code>, <code>var()</code>, <code>sd()</code>, <code>mad()</code>, <code>IQR()</code>, <code>min()</code>, and <code>max()</code>. Remember they are functions that take <span class="math inline">\(n\)</span> inputs and distill them down into 1 output.</p>
<p>Although this may be statistically ill-advised, let’s compute the average life expectancy by continent.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(continent) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_lifeExp =</span> <span class="kw">mean</span>(lifeExp))</code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   continent avg_lifeExp
##      &lt;fctr&gt;       &lt;dbl&gt;
## 1    Africa    48.86533
## 2  Americas    64.65874
## 3      Asia    60.06490
## 4    Europe    71.90369
## 5   Oceania    74.32621</code></pre>
<p><code>summarize_each()</code> applies the same summary function(s) to multiple variables. Let’s compute average and median life expectancy and GDP per capita by continent by year … but only for 1952 and 2007.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(year %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1952</span>, <span class="dv">2007</span>)) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(continent, year) %&gt;%
<span class="st">  </span><span class="kw">summarise_each</span>(<span class="kw">funs</span>(mean, median), lifeExp, gdpPercap)</code></pre></div>
<pre><code>## `summarise_each()` is deprecated.
## Use `summarise_all()`, `summarise_at()` or `summarise_if()` instead.
## To map `funs` over a selection of variables, use `summarise_at()`</code></pre>
<pre><code>## # A tibble: 10 x 6
## # Groups:   continent [?]
##    continent  year lifeExp_mean gdpPercap_mean lifeExp_median
##       &lt;fctr&gt; &lt;int&gt;        &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
##  1    Africa  1952     39.13550       1252.572        38.8330
##  2    Africa  2007     54.80604       3089.033        52.9265
##  3  Americas  1952     53.27984       4079.063        54.7450
##  4  Americas  2007     73.60812      11003.032        72.8990
##  5      Asia  1952     46.31439       5195.484        44.8690
##  6      Asia  2007     70.72848      12473.027        72.3960
##  7    Europe  1952     64.40850       5661.057        65.9000
##  8    Europe  2007     77.64860      25054.482        78.6085
##  9   Oceania  1952     69.25500      10298.086        69.2550
## 10   Oceania  2007     80.71950      29810.188        80.7195
## # ... with 1 more variables: gdpPercap_median &lt;dbl&gt;</code></pre>
<p>Let’s focus just on Asia. What are the minimum and maximum life expectancies seen by year?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(continent ==<span class="st"> &quot;Asia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">min_lifeExp =</span> <span class="kw">min</span>(lifeExp), <span class="dt">max_lifeExp =</span> <span class="kw">max</span>(lifeExp))</code></pre></div>
<pre><code>## # A tibble: 12 x 3
##     year min_lifeExp max_lifeExp
##    &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1  1952      28.801      65.390
##  2  1957      30.332      67.840
##  3  1962      31.997      69.390
##  4  1967      34.020      71.430
##  5  1972      36.088      73.420
##  6  1977      31.220      75.380
##  7  1982      39.854      77.110
##  8  1987      40.822      78.670
##  9  1992      41.674      79.360
## 10  1997      41.763      80.690
## 11  2002      42.129      82.000
## 12  2007      43.828      82.603</code></pre>
<p>Of course it would be much more interesting to see <em>which</em> country contributed these extreme observations. Is the minimum (maximum) always coming from the same country? We tackle that with window functions shortly.</p>
</div>
</div>
<div id="grouped-mutate" class="section level3">
<h3><span class="header-section-number">7.4.7</span> Grouped mutate</h3>
<p>Sometimes you don’t want to collapse the <span class="math inline">\(n\)</span> rows for each group into one row. You want to keep your groups, but compute within them.</p>
<div id="computing-with-group-wise-summaries" class="section level4">
<h4><span class="header-section-number">7.4.7.1</span> Computing with group-wise summaries</h4>
<p>Let’s make a new variable that is the years of life expectancy gained (lost) relative to 1952, for each individual country. We group by country and use <code>mutate()</code> to make a new variable. The <code>first()</code> function extracts the first value from a vector. Notice that <code>first()</code> is operating on the vector of life expectancies <em>within each country group</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(country) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(country, year, lifeExp) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lifeExp_gain =</span> lifeExp -<span class="st"> </span><span class="kw">first</span>(lifeExp)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year &lt;<span class="st"> </span><span class="dv">1963</span>)</code></pre></div>
<pre><code>## # A tibble: 426 x 4
## # Groups:   country [142]
##        country  year lifeExp lifeExp_gain
##         &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afghanistan  1952  28.801        0.000
##  2 Afghanistan  1957  30.332        1.531
##  3 Afghanistan  1962  31.997        3.196
##  4     Albania  1952  55.230        0.000
##  5     Albania  1957  59.280        4.050
##  6     Albania  1962  64.820        9.590
##  7     Algeria  1952  43.077        0.000
##  8     Algeria  1957  45.685        2.608
##  9     Algeria  1962  48.303        5.226
## 10      Angola  1952  30.015        0.000
## # ... with 416 more rows</code></pre>
<p>Within country, we take the difference between life expectancy in year <span class="math inline">\(i\)</span> and life expectancy in 1952. Therefore we always see zeroes for 1952 and, for most countries, a sequence of positive and increasing numbers.</p>
</div>
<div id="window-functions" class="section level4">
<h4><span class="header-section-number">7.4.7.2</span> Window functions</h4>
<p>Window functions take <span class="math inline">\(n\)</span> inputs and give back <span class="math inline">\(n\)</span> outputs. Furthermore, the output depends on all the values. So <code>rank()</code> is a window function but <code>log()</code> is not. Here we use window functions based on ranks and offsets.</p>
<p>Let’s revisit the worst and best life expectancies in Asia over time, but retaining info about <em>which</em> country contributes these extreme values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(continent ==<span class="st"> &quot;Asia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(year, country, lifeExp) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">min_rank</span>(<span class="kw">desc</span>(lifeExp)) &lt;<span class="st"> </span><span class="dv">2</span> |<span class="st"> </span><span class="kw">min_rank</span>(lifeExp) &lt;<span class="st"> </span><span class="dv">2</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(year) %&gt;%
<span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</code></pre></div>
<pre><code>## # A tibble: 24 x 3
## # Groups:   year [12]
##     year     country lifeExp
##    &lt;int&gt;      &lt;fctr&gt;   &lt;dbl&gt;
##  1  1952 Afghanistan  28.801
##  2  1952      Israel  65.390
##  3  1957 Afghanistan  30.332
##  4  1957      Israel  67.840
##  5  1962 Afghanistan  31.997
##  6  1962      Israel  69.390
##  7  1967 Afghanistan  34.020
##  8  1967       Japan  71.430
##  9  1972 Afghanistan  36.088
## 10  1972       Japan  73.420
## 11  1977    Cambodia  31.220
## 12  1977       Japan  75.380
## 13  1982 Afghanistan  39.854
## 14  1982       Japan  77.110
## 15  1987 Afghanistan  40.822
## 16  1987       Japan  78.670
## 17  1992 Afghanistan  41.674
## 18  1992       Japan  79.360
## 19  1997 Afghanistan  41.763
## 20  1997       Japan  80.690
## 21  2002 Afghanistan  42.129
## 22  2002       Japan  82.000
## 23  2007 Afghanistan  43.828
## 24  2007       Japan  82.603</code></pre>
<p>We see that (min = Afghanistan, max = Japan) is the most frequent result, but Cambodia and Israel pop up at least once each as the min or max, respectively. That table should make you impatient for our upcoming work on tidying and reshaping data! Wouldn’t it be nice to have one row per year?</p>
<p>How did that actually work? First, I store and view a partial that leaves off the <code>filter()</code> statement. All of these operations should be familiar.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">asia &lt;-<span class="st"> </span>my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(continent ==<span class="st"> &quot;Asia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(year, country, lifeExp) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year)
asia</code></pre></div>
<pre><code>## # A tibble: 396 x 3
## # Groups:   year [12]
##     year     country lifeExp
##    &lt;int&gt;      &lt;fctr&gt;   &lt;dbl&gt;
##  1  1952 Afghanistan  28.801
##  2  1957 Afghanistan  30.332
##  3  1962 Afghanistan  31.997
##  4  1967 Afghanistan  34.020
##  5  1972 Afghanistan  36.088
##  6  1977 Afghanistan  38.438
##  7  1982 Afghanistan  39.854
##  8  1987 Afghanistan  40.822
##  9  1992 Afghanistan  41.674
## 10  1997 Afghanistan  41.763
## # ... with 386 more rows</code></pre>
<p>Now we apply a window function – <code>min_rank()</code>. Since <code>asia</code> is grouped by year, <code>min_rank()</code> operates within mini-datasets, each for a specific year. Applied to the variable <code>lifeExp</code>, <code>min_rank()</code> returns the rank of each country’s observed life expectancy. FYI, the <code>min</code> part just specifies how ties are broken. Here is an explicit peek at these within-year life expectancy ranks, in both the (default) ascending and descending order.</p>
<p>For concreteness, I use <code>mutate()</code> to actually create these variables, even though I dropped this in the solution above. Let’s look at a bit of that.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">asia %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">le_rank =</span> <span class="kw">min_rank</span>(lifeExp),
         <span class="dt">le_desc_rank =</span> <span class="kw">min_rank</span>(<span class="kw">desc</span>(lifeExp))) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(country %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Thailand&quot;</span>), year &gt;<span class="st"> </span><span class="dv">1995</span>)</code></pre></div>
<pre><code>## # A tibble: 9 x 5
## # Groups:   year [3]
##    year     country lifeExp le_rank le_desc_rank
##   &lt;int&gt;      &lt;fctr&gt;   &lt;dbl&gt;   &lt;int&gt;        &lt;int&gt;
## 1  1997 Afghanistan  41.763       1           33
## 2  2002 Afghanistan  42.129       1           33
## 3  2007 Afghanistan  43.828       1           33
## 4  1997       Japan  80.690      33            1
## 5  2002       Japan  82.000      33            1
## 6  2007       Japan  82.603      33            1
## 7  1997    Thailand  67.521      12           22
## 8  2002    Thailand  68.564      12           22
## 9  2007    Thailand  70.616      12           22</code></pre>
<p>Afghanistan tends to present 1’s in the <code>le_rank</code> variable, Japan tends to present 1’s in the <code>le_desc_rank</code> variable and other countries, like Thailand, present less extreme ranks.</p>
<p>You can understand the original <code>filter()</code> statement now:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(<span class="kw">min_rank</span>(<span class="kw">desc</span>(lifeExp)) &lt;<span class="st"> </span><span class="dv">2</span> |<span class="st"> </span><span class="kw">min_rank</span>(lifeExp) &lt;<span class="st"> </span><span class="dv">2</span>)</code></pre></div>
<p>These two sets of ranks are formed on-the-fly, within year group, and <code>filter()</code> retains rows with rank less than 2, which means … the row with rank = 1. Since we do for ascending and descending ranks, we get both the min and the max.</p>
<p>If we had wanted just the min OR the max, an alternative approach using <code>top_n()</code> would have worked.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">filter</span>(continent ==<span class="st"> &quot;Asia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(year, country, lifeExp) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(year) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year) %&gt;%
<span class="st">  </span><span class="co">#top_n(1, wt = lifeExp)        ## gets the min</span>
<span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, <span class="dt">wt =</span> <span class="kw">desc</span>(lifeExp)) ## gets the max</code></pre></div>
<pre><code>## # A tibble: 12 x 3
## # Groups:   year [12]
##     year     country lifeExp
##    &lt;int&gt;      &lt;fctr&gt;   &lt;dbl&gt;
##  1  1952 Afghanistan  28.801
##  2  1957 Afghanistan  30.332
##  3  1962 Afghanistan  31.997
##  4  1967 Afghanistan  34.020
##  5  1972 Afghanistan  36.088
##  6  1977    Cambodia  31.220
##  7  1982 Afghanistan  39.854
##  8  1987 Afghanistan  40.822
##  9  1992 Afghanistan  41.674
## 10  1997 Afghanistan  41.763
## 11  2002 Afghanistan  42.129
## 12  2007 Afghanistan  43.828</code></pre>
</div>
</div>
<div id="grand-finale" class="section level3">
<h3><span class="header-section-number">7.4.8</span> Grand Finale</h3>
<p>So let’s answer that “simple” question: which country experienced the sharpest 5-year drop in life expectancy? Recall that this excerpt of the Gapminder data only has data every five years, e.g. for 1952, 1957, etc. So this really means looking at life expectancy changes between adjacent timepoints.</p>
<p>At this point, that’s just too easy, so let’s do it by continent while we’re at it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_gap %&gt;%
<span class="st">  </span><span class="kw">select</span>(country, year, continent, lifeExp) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(continent, country) %&gt;%
<span class="st">  </span>## within country, take (lifeExp in year i) - (lifeExp in year i - 1)
<span class="st">  </span>## positive means lifeExp went up, negative means it went down
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">le_delta =</span> lifeExp -<span class="st"> </span><span class="kw">lag</span>(lifeExp)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## within country, retain the worst lifeExp change = smallest or most negative
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">worst_le_delta =</span> <span class="kw">min</span>(le_delta, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## within continent, retain the row with the lowest worst_le_delta
<span class="st">  </span><span class="kw">top_n</span>(-<span class="dv">1</span>, <span class="dt">wt =</span> worst_le_delta) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(worst_le_delta)</code></pre></div>
<pre><code>## # A tibble: 5 x 3
## # Groups:   continent [5]
##   continent     country worst_le_delta
##      &lt;fctr&gt;      &lt;fctr&gt;          &lt;dbl&gt;
## 1    Africa      Rwanda        -20.421
## 2      Asia    Cambodia         -9.097
## 3  Americas El Salvador         -1.511
## 4    Europe  Montenegro         -1.464
## 5   Oceania   Australia          0.170</code></pre>
<p>Ponder that for a while. The subject matter and the code. Mostly you’re seeing what genocide looks like in dry statistics on average life expectancy.</p>
<p>Break the code into pieces, starting at the top, and inspect the intermediate results. That’s certainly how I was able to <em>write</em> such a thing. These commands do not <a href="http://tinyurl.com/athenaforehead">leap fully formed out of anyone’s forehead</a> – they are built up gradually, with lots of errors and refinements along the way. I’m not even sure it’s a great idea to do so much manipulation in one fell swoop. Is the statement above really hard for you to read? If yes, then by all means break it into pieces and make some intermediate objects. Your code should be easy to write and read when you’re done.</p>
</div>
</div>
<div id="working-with-two-datasets" class="section level2">
<h2><span class="header-section-number">7.5</span> Working with two datasets</h2>
<p>When working with two or more datasets, we routinely join them. <code>dplyr</code> adopts the SQL-dialect for joining datasets. Below are examples for those of us who don’t speak SQL so good. There are lots of <a href="https://encrypted.google.com/search?q=sql+join&amp;tbm=isch">Venn diagrams re: SQL joins on the interwebs</a>, but I wanted R examples.</p>
<p><a href="http://www.rdocumentation.org/packages/dplyr">Full documentation</a> for the dplyr package, which is developed by Hadley Wickham and Romain Francois on <a href="https://github.com/hadley/dplyr">GitHub</a>. The <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html">vignette on Two-table verbs</a> covers the joins shown here.</p>
<p>Working with two small data.frames, <code>superheroes</code> and <code>publishers</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(dplyr))
<span class="kw">library</span>(readr)

superheroes &lt;-<span class="st"> &quot;</span>
<span class="st">    name, alignment, gender,         publisher</span>
<span class="st"> Magneto,       bad,   male,            Marvel</span>
<span class="st">   Storm,      good, female,            Marvel</span>
<span class="st">Mystique,       bad, female,            Marvel</span>
<span class="st">  Batman,      good,   male,                DC</span>
<span class="st">   Joker,       bad,   male,                DC</span>
<span class="st">Catwoman,       bad, female,                DC</span>
<span class="st"> Hellboy,      good,   male, Dark Horse Comics</span>
<span class="st">&quot;</span>
superheroes &lt;-<span class="st"> </span><span class="kw">read_csv</span>(superheroes, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>, <span class="dt">skip =</span> <span class="dv">1</span>)

publishers &lt;-<span class="st"> &quot;</span>
<span class="st">  publisher, yr_founded</span>
<span class="st">         DC,       1934</span>
<span class="st">     Marvel,       1939</span>
<span class="st">      Image,       1992</span>
<span class="st">&quot;</span>
publishers &lt;-<span class="st"> </span><span class="kw">read_csv</span>(publishers, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>, <span class="dt">skip =</span> <span class="dv">1</span>)</code></pre></div>
<p>Sorry, cheat sheet does not illustrate “multiple match” situations terribly well.</p>
<p>Sub-plot: watch the row and variable order of the join results for a healthy reminder of why it’s dangerous to rely on any of that in an analysis.</p>
<p>You probably don’t need to memorize each of these functions, but you should be aware of their difference. When coming across problems requiring dataset join, think about which type of joins you need and <code>?dplyr::join</code> to look up the appropriate function.</p>
<div id="inner_joinsuperheroes-publishers" class="section level3">
<h3><span class="header-section-number">7.5.1</span> inner_join(superheroes, publishers)</h3>
<blockquote>
<p>inner_join(x, y): Return all rows from x where there are matching values in y, and all columns from x and y. If there are multiple matches between x and y, all combination of the matches are returned. This is a mutating join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ijsp &lt;-<span class="st"> </span><span class="kw">inner_join</span>(superheroes, publishers))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 6 x 5
##       name alignment gender publisher yr_founded
##      &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;int&gt;
## 1  Magneto       bad   male    Marvel       1939
## 2    Storm      good female    Marvel       1939
## 3 Mystique       bad female    Marvel       1939
## 4   Batman      good   male        DC       1934
## 5    Joker       bad   male        DC       1934
## 6 Catwoman       bad female        DC       1934</code></pre>
<p>We lose Hellboy in the join because, although he appears in <code>x = superheroes</code>, his publisher Dark Horse Comics does not appear in <code>y = publishers</code>. The join result has all variables from <code>x = superheroes</code> plus <code>yr_founded</code>, from <code>y</code>.</p>
<table border="1">
<tr>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>inner_join(x = superheroes, y = publishers)</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div id="semi_joinsuperheroes-publishers" class="section level3">
<h3><span class="header-section-number">7.5.2</span> semi_join(superheroes, publishers)</h3>
<blockquote>
<p>semi_join(x, y): Return all rows from x where there are matching values in y, keeping just columns from x. A semi join differs from an inner join because an inner join will return one row of x for each matching row of y, where a semi join will never duplicate rows of x. This is a filtering join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(sjsp &lt;-<span class="st"> </span><span class="kw">semi_join</span>(superheroes, publishers))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 6 x 4
##       name alignment gender publisher
##      &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;
## 1  Magneto       bad   male    Marvel
## 2    Storm      good female    Marvel
## 3 Mystique       bad female    Marvel
## 4   Batman      good   male        DC
## 5    Joker       bad   male        DC
## 6 Catwoman       bad female        DC</code></pre>
<p>We get a similar result as with <code>inner_join()</code> but the join result contains only the variables originally found in <code>x = superheroes</code>. But note the row order has changed.</p>
<table border="1">
<tr>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>semi-join(x = superheroes, y = publishers)</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div id="left_joinsuperheroes-publishers" class="section level3">
<h3><span class="header-section-number">7.5.3</span> left_join(superheroes, publishers)</h3>
<blockquote>
<p>left_join(x, y): Return all rows from x, and all columns from x and y. If there are multiple matches between x and y, all combination of the matches are returned. This is a mutating join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ljsp &lt;-<span class="st"> </span><span class="kw">left_join</span>(superheroes, publishers))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 7 x 5
##       name alignment gender         publisher yr_founded
##      &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;             &lt;chr&gt;      &lt;int&gt;
## 1  Magneto       bad   male            Marvel       1939
## 2    Storm      good female            Marvel       1939
## 3 Mystique       bad female            Marvel       1939
## 4   Batman      good   male                DC       1934
## 5    Joker       bad   male                DC       1934
## 6 Catwoman       bad female                DC       1934
## 7  Hellboy      good   male Dark Horse Comics         NA</code></pre>
<p>We basically get <code>x = superheroes</code> back, but with the addition of variable <code>yr_founded</code>, which is unique to <code>y = publishers</code>. Hellboy, whose publisher does not appear in <code>y = publishers</code>, has an <code>NA</code> for <code>yr_founded</code>.</p>
<table border="1">
<tr>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>left_join(x = superheroes, y = publishers)</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div id="anti_joinsuperheroes-publishers" class="section level3">
<h3><span class="header-section-number">7.5.4</span> anti_join(superheroes, publishers)</h3>
<blockquote>
<p>anti_join(x, y): Return all rows from x where there are not matching values in y, keeping just columns from x. This is a filtering join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ajsp &lt;-<span class="st"> </span><span class="kw">anti_join</span>(superheroes, publishers))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 1 x 4
##      name alignment gender         publisher
##     &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;             &lt;chr&gt;
## 1 Hellboy      good   male Dark Horse Comics</code></pre>
<p>We keep <strong>only</strong> Hellboy now (and do not get <code>yr_founded</code>).</p>
<table border="1">
<tr>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>anti_join(x = superheroes, y = publishers)</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div id="inner_joinpublishers-superheroes" class="section level3">
<h3><span class="header-section-number">7.5.5</span> inner_join(publishers, superheroes)</h3>
<blockquote>
<p>inner_join(x, y): Return all rows from x where there are matching values in y, and all columns from x and y. If there are multiple matches between x and y, all combination of the matches are returned. This is a mutating join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ijps &lt;-<span class="st"> </span><span class="kw">inner_join</span>(publishers, superheroes))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 6 x 5
##   publisher yr_founded     name alignment gender
##       &lt;chr&gt;      &lt;int&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;
## 1        DC       1934   Batman      good   male
## 2        DC       1934    Joker       bad   male
## 3        DC       1934 Catwoman       bad female
## 4    Marvel       1939  Magneto       bad   male
## 5    Marvel       1939    Storm      good female
## 6    Marvel       1939 Mystique       bad female</code></pre>
<p>In a way, this does illustrate multiple matches, if you think about it from the <code>x = publishers</code> direction. Every publisher that has a match in <code>y = superheroes</code> appears multiple times in the result, once for each match. In fact, we’re getting the same result as with <code>inner_join(superheroes, publishers)</code>, up to variable order (which you should also never rely on in an analysis).</p>
<table border="1">
<tr>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>inner_join(x = publishers, y = superheroes)</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
</tr>
<tr class="even">
<td align="left">DC</td>
<td align="right">1934</td>
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
</tr>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
</tr>
<tr class="odd">
<td align="left">Marvel</td>
<td align="right">1939</td>
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div id="semi_joinpublishers-superheroes" class="section level3">
<h3><span class="header-section-number">7.5.6</span> semi_join(publishers, superheroes)</h3>
<blockquote>
<p>semi_join(x, y): Return all rows from x where there are matching values in y, keeping just columns from x. A semi join differs from an inner join because an inner join will return one row of x for each matching row of y, where a semi join will never duplicate rows of x. This is a filtering join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(sjps &lt;-<span class="st"> </span><span class="kw">semi_join</span>(<span class="dt">x =</span> publishers, <span class="dt">y =</span> superheroes))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 2 x 2
##   publisher yr_founded
##       &lt;chr&gt;      &lt;int&gt;
## 1        DC       1934
## 2    Marvel       1939</code></pre>
<p>Now the effects of switching the <code>x</code> and <code>y</code> roles is more clear. The result resembles <code>x = publishers</code>, but the publisher Image is lost, because there are no observations where <code>publisher == &quot;Image&quot;</code> in <code>y = superheroes</code>.</p>
<table border="1">
<tr>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>semi-join(x = publishers, y = superheroes)</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div id="left_joinpublishers-superheroes" class="section level3">
<h3><span class="header-section-number">7.5.7</span> left_join(publishers, superheroes)</h3>
<blockquote>
<p>left_join(x, y): Return all rows from x, and all columns from x and y. If there are multiple matches between x and y, all combination of the matches are returned. This is a mutating join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ljps &lt;-<span class="st"> </span><span class="kw">left_join</span>(publishers, superheroes))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 7 x 5
##   publisher yr_founded     name alignment gender
##       &lt;chr&gt;      &lt;int&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;
## 1        DC       1934   Batman      good   male
## 2        DC       1934    Joker       bad   male
## 3        DC       1934 Catwoman       bad female
## 4    Marvel       1939  Magneto       bad   male
## 5    Marvel       1939    Storm      good female
## 6    Marvel       1939 Mystique       bad female
## 7     Image       1992     &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;</code></pre>
<p>We get a similar result as with <code>inner_join()</code> but the publisher Image survives in the join, even though no superheroes from Image appear in <code>y = superheroes</code>. As a result, Image has <code>NA</code>s for <code>name</code>, <code>alignment</code>, and <code>gender</code>.</p>
<table border="1">
<tr>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>left_join(x = publishers, y = superheroes)</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
</tr>
<tr class="even">
<td align="left">DC</td>
<td align="right">1934</td>
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
</tr>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
</tr>
<tr class="odd">
<td align="left">Marvel</td>
<td align="right">1939</td>
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div id="anti_joinpublishers-superheroes" class="section level3">
<h3><span class="header-section-number">7.5.8</span> anti_join(publishers, superheroes)</h3>
<blockquote>
<p>anti_join(x, y): Return all rows from x where there are not matching values in y, keeping just columns from x. This is a filtering join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ajps &lt;-<span class="st"> </span><span class="kw">anti_join</span>(publishers, superheroes))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 1 x 2
##   publisher yr_founded
##       &lt;chr&gt;      &lt;int&gt;
## 1     Image       1992</code></pre>
<p>We keep <strong>only</strong> publisher Image now (and the variables found in <code>x = publishers</code>).</p>
<table border = 1>
<tr>
<tr>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>anti_join(x = publishers, y = superheroes)</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div id="full_joinsuperheroes-publishers" class="section level3">
<h3><span class="header-section-number">7.5.9</span> full_join(superheroes, publishers)</h3>
<blockquote>
<p>full_join(x, y): Return all rows and all columns from both x and y. Where there are not matching values, returns NA for the one missing. This is a mutating join.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(fjsp &lt;-<span class="st"> </span><span class="kw">full_join</span>(superheroes, publishers))</code></pre></div>
<pre><code>## Joining, by = &quot;publisher&quot;</code></pre>
<pre><code>## # A tibble: 8 x 5
##       name alignment gender         publisher yr_founded
##      &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;             &lt;chr&gt;      &lt;int&gt;
## 1  Magneto       bad   male            Marvel       1939
## 2    Storm      good female            Marvel       1939
## 3 Mystique       bad female            Marvel       1939
## 4   Batman      good   male                DC       1934
## 5    Joker       bad   male                DC       1934
## 6 Catwoman       bad female                DC       1934
## 7  Hellboy      good   male Dark Horse Comics         NA
## 8     &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;             Image       1992</code></pre>
<p>We get all rows of <code>x = superheroes</code> plus a new row from <code>y = publishers</code>, containing the publisher Image. We get all variables from <code>x = superheroes</code> AND all variables from <code>y = publishers</code>. Any row that derives solely from one table or the other carries <code>NA</code>s in the variables found only in the other table.</p>
<table border="1">
<tr>
<td valign="top">
<p>superheroes</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>publishers</p>
<table>
<thead>
<tr class="header">
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
<td valign="top">
<p>full_join(x = superheroes, y = publishers)</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">alignment</th>
<th align="left">gender</th>
<th align="left">publisher</th>
<th align="right">yr_founded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Magneto</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="even">
<td align="left">Storm</td>
<td align="left">good</td>
<td align="left">female</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="odd">
<td align="left">Mystique</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">Marvel</td>
<td align="right">1939</td>
</tr>
<tr class="even">
<td align="left">Batman</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="odd">
<td align="left">Joker</td>
<td align="left">bad</td>
<td align="left">male</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="even">
<td align="left">Catwoman</td>
<td align="left">bad</td>
<td align="left">female</td>
<td align="left">DC</td>
<td align="right">1934</td>
</tr>
<tr class="odd">
<td align="left">Hellboy</td>
<td align="left">good</td>
<td align="left">male</td>
<td align="left">Dark Horse Comics</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Image</td>
<td align="right">1992</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
</div>
<div id="learn-more-2" class="section level2">
<h2><span class="header-section-number">7.6</span> Learn more</h2>
<ul>
<li>package home <a href="http://cran.r-project.org/web/packages/dplyr/index.html">on CRAN</a>
<ul>
<li>note there are several vignettes, with the <a href="http://cran.r-project.org/web/packages/dplyr/vignettes/introduction.html">introduction</a> being the most relevant right now</li>
<li>the <a href="http://cran.rstudio.com/web/packages/dplyr/vignettes/window-functions.html">one on window functions</a> will also be interesting to you now</li>
</ul></li>
<li><p><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">RStudio Data Wrangling cheatsheet</a>, covering <code>dplyr</code> and <code>tidyr</code>. Remember you can get to these via <em>Help &gt; Cheatsheets.</em></p></li>
<li><p><a href="https://github.com/tjmahr/MadR_Pipelines">Excellent slides</a> on pipelines and <code>dplyr</code> by TJ Mahr, talk given to the Madison R Users Group.</p></li>
<li><p>Blog post <a href="http://www.dataschool.io/dplyr-tutorial-for-faster-data-manipulation-in-r/">Hands-on dplyr tutorial for faster data manipulation in R</a> by Data School, that includes a link to an R Markdown document and links to videos</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualize.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
